/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.server
 *     File: ./flair.server.js
 *  Version: 0.60.0
 *  Mon, 23 Sep 2019 05:12:59 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(e,t){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>t):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),module.exports=exports=t):e["flair.server"]=t}(this,async function(e,t){"use strict";const{Class:s,Struct:i,Enum:r,Interface:a,Mixin:n,Aspects:o,AppDomain:l,$$:c,attr:h,bring:d,Container:p,include:u,Port:f,on:y,post:g,telemetry:m,Reflector:v,Serializer:b,Tasks:q,as:w,is:k,isDefined:C,isComplies:P,isDerivedFrom:x,isAbstract:A,isSealed:R,isStatic:S,isSingleton:H,isDeprecated:O,isImplements:I,isInstanceOf:T,isMixed:j,getAssembly:N,getAttr:D,getContext:B,getResource:E,getRoute:L,getType:F,ns:J,getTypeOf:V,getTypeName:M,typeOf:U,dispose:$,using:z,Args:G,Exception:W,noop:K,nip:Q,nim:X,nie:Y,event:Z}=e,{TaskInfo:_}=e.Tasks,{env:ee}=e.options,{guid:te,stuff:se,replaceAll:ie,splitAndTrim:re,findIndexByProp:ae,findItemByProp:ne,which:oe,isArrowFunc:le,isASyncFunc:ce,sieve:he,deepMerge:de,getLoadedScript:pe,b64EncodeUnicode:ue,b64DecodeUnicode:fe,lens:ye,globalSetting:ge}=e.utils,me=ee.isServer||ee.isWorker?null:(!0).document,ve=l.context.current().name,be=t,qe=be.substr(0,be.lastIndexOf("/")+1);l.loadPathOf("flair.server",qe);let we=JSON.parse('{"envVars":{"vars":[],"options":{"overwrite":true}}}'),ke=f("settingsReader");if("function"==typeof ke){let e=ke("flair.server");e&&(we=de([we,e],!1))}we=Object.freeze(we);let Ce=JSON.parse("{}");return Ce=Object.freeze(Ce),l.context.current().currentAssemblyBeingLoaded("./flair.server{.min}.js"),await(async()=>{const{Payload:e}=await J("flair.app"),t=require("path");c("ns","flair.api"),s("AttachmentPayload",e,function(){c("override"),this.construct=((e,s,i,r,a,n,o,l)=>{if(!this.file)throw W.InvalidArgument("file");e(s,i,r,l),this.file=s||"",this.displayName=a||t.basename(this.file),this.options=n||null,this.cb=o||null,this.resHeaders.push({name:"Content-disposition",value:`attachment;filename=${this.displayName||"unknown.unknown"}`})}),c("readonly"),this.file="",c("readonly"),this.displayName="",c("readonly"),this.options=null,c("readonly"),this.cb=null})})(),await(async()=>{const{Payload:e}=await J("flair.app");c("ns","flair.api"),s("BinaryPayload",e,function(){c("override"),this.construct=((e,t,s,i,r,a,n)=>{if(!t)throw W.InvalidArgument("data");this.buffer=Buffer.from(t,this.encoding),e(this.buffer,s,i,n),this.cb=a||null,this.resHeaders.push({name:"Content-disposition",value:`attachment;filename=${r||"unknown.unknown"}`}),this.resHeaders.push({name:"Content-Length",value:this.buffer.length})}),c("readonly"),this.buffer=null,c("readonly"),this.encoding="binary",c("readonly"),this.cb=null})})(),await(async()=>{const{Payload:e}=await J("flair.app");c("ns","flair.api"),s("JSONPayload",e,function(){c("override"),this.construct=((e,t,s,i,r)=>{if(!t)throw W.InvalidArgument("data");e(t,s,"application/json",r),this.isJsonP=i||!1}),c("readonly"),this.isJsonP=!1})})(),await(async()=>{const{HandlerResult:e}=await J("flair.app");c("ns","flair.api"),s("RestHandlerResult",e,function(){c("override"),this.construct=((e,t,s,i)=>{e(t,s,i)})})})(),await(async()=>{const{HandlerContext:e}=await J("flair.app");c("ns","flair.api"),s("RestHandlerContext",e,function(){c("override"),this.construct=((e,t,s)=>{e(),this.req=t,this.res=s}),c("readonly"),this.req=null,c("readonly"),this.res=null,this.redirect=((e,t,s,i)=>{throw this.setData("redirect-route",e),this.setData("redirect-status",t||302),this.setData("redirect-params",s||null),this.setData("redirect-query",i||null),W.Redirect(e)}),this.isHeadersSent={get:()=>this.res.headersSent},this.getResHeader=(e=>this.res.get(e)),this.setHeader=((e,t,s)=>{s?this.res.append(e,t):this.res.set(e,t)}),this.setCookie=((e,t,s)=>{this.res.cookie(e,t,s)}),this.clearCookie=((e,t)=>{this.res.clearCookie(e,t)}),this.isAjaxReq={get:()=>this.req.xhr},this.isStale={get:()=>this.req.stale},this.isFresh={get:()=>this.req.fresh},this.isSecure={get:()=>this.req.secure},this.url={get:()=>this.req.url},this.originalUrl={get:()=>this.req.originalUrl},this.baseUrl={get:()=>this.req.baseUrl},this.route={get:()=>this.req.route},this.ip={get:()=>this.req.ip},this.ips={get:()=>this.req.ips},this.hostName={get:()=>this.req.hostname},this.subDomains={get:()=>this.req.subdomains},this.protocol={get:()=>this.req.protocol},this.path={get:()=>this.req.path},this.method={get:()=>this.req.method},this.body={get:()=>this.req.body},this.params={get:()=>this.req.params},this.query={get:()=>this.req.query},this.isContentType=(e=>"string"==typeof this.req.is(e)),this.getHeader=(e=>this.req.get(e)),this.getCookie=((e,t)=>{if(t){if(this.req.signedCookies)return this.req.signedCookies[e]||null}else if(this.req.cookies)return this.req.cookies[e]||null;return null}),this.acceptsContentType=((...e)=>this.req.accepts(e)),this.acceptsCharset=((...e)=>this.req.acceptsCharsets(e)),this.acceptsEncoding=((...e)=>this.req.acceptsEncodings(e)),this.acceptsLanguage=((...e)=>this.req.acceptsLanguages(e))})})(),await(async()=>{const{Handler:e}=await J("flair.app"),{RestHandlerResult:t}=await J("flair.api");c("ns","flair.api"),s("RestHandler",e,function(){c("override"),this.construct=((e,t)=>{e(t)}),c("override"),this.run=(async(e,s,i)=>{e(s,i);let r=null,a=null,n=null,o,l;switch(s){case"get":n=this.onGet;break;case"post":n=this.onPost;break;case"put":n=this.onPut;break;case"patch":n=this.onPatch;break;case"delete":n=this.onDelete;break;case"head":n=this.onHead;break;case"options":n=this.onOptions;break;case"trace":n=this.onTrace;break}if(n)try{r=await n(i)}catch(e){a=e}else a=W.NotImplemented(`Verb ${s} is not implemented.`);return!!!a&&k(r,t)||(r=new t(a,r)),r}),c("protected"),c("virtual"),c("async"),this.onGet=K,c("protected"),c("virtual"),c("async"),this.onPost=K,c("protected"),c("virtual"),c("async"),this.onPut=K,c("protected"),c("virtual"),c("async"),this.onPatch=K,c("protected"),c("virtual"),c("async"),this.onDelete=K,c("protected"),c("virtual"),c("async"),this.onHead=K,c("protected"),c("virtual"),c("async"),this.onOptions=K,c("protected"),c("virtual"),c("async"),this.onTrace=K})})(),await(async()=>{c("ns","flair.api"),s("RestInterceptor",function(){c("virtual"),c("async"),this.run=K})})(),await(async()=>{const{Bootware:e}=await J("flair.app");c("sealed"),c("ns","flair.boot"),s("NodeEnv",e,function(){c("override"),this.construct=(e=>{e("Node Server Environment")}),c("override"),this.boot=(async e=>{if(e(),we.envVars.vars.length>0){const e=await u("node-env-file | x");if(e)for(let t of we.envVars.vars)e(l.resolvePath(t),we.envVars.options)}})})})(),l.context.current().currentAssemblyBeingLoaded("","function"==typeof onLoadComplete?onLoadComplete:null),l.registerAdo('{"name":"flair.server","file":"./flair.server{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.60.0","lupdate":"Mon, 23 Sep 2019 05:12:59 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.api.AttachmentPayload","flair.api.BinaryPayload","flair.api.JSONPayload","flair.api.RestHandlerResult","flair.api.RestHandlerContext","flair.api.RestHandler","flair.api.RestInterceptor","flair.boot.NodeEnv"],"resources":[],"assets":["main.js","start.js"],"routes":[]}'),Object.freeze({name:"flair.server",settings:we,config:Ce})});