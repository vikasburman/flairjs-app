/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.server
 *     File: ./flair.server.js
 *  Version: 0.60.22
 *  Wed, 25 Sep 2019 04:57:44 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(e,t){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>t):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),module.exports=exports=t):e["flair.server"]=t}(this,async function(e,t){"use strict";const{Class:s,Struct:i,Enum:r,Interface:a,Mixin:n,Aspects:o,AppDomain:l,$$:c,attr:h,InjectedArg:d,bring:p,Container:u,include:f,Port:y,on:g,post:m,telemetry:v,Reflector:b,Serializer:q,Tasks:w,as:k,is:C,isDefined:P,isComplies:x,isDerivedFrom:A,isAbstract:R,isSealed:S,isStatic:H,isSingleton:O,isDeprecated:I,isImplements:j,isInstanceOf:T,isMixed:N,getAssembly:D,getAttr:B,getContext:E,getResource:L,getRoute:F,getType:J,ns:V,getTypeOf:U,getTypeName:M,typeOf:$,dispose:z,using:G,Args:W,Exception:K,noop:Q,nip:X,nim:Y,nie:Z,event:_}=e,{TaskInfo:ee}=e.Tasks,{env:te}=e.options,{guid:se,stuff:ie,replaceAll:re,splitAndTrim:ae,findIndexByProp:ne,findItemByProp:oe,which:le,isArrowFunc:ce,isASyncFunc:he,sieve:de,deepMerge:pe,getLoadedScript:ue,b64EncodeUnicode:fe,b64DecodeUnicode:ye,lens:ge,globalSetting:me}=e.utils,ve=te.isServer||te.isWorker?null:(!0).document,be=l.context.current().name,qe=t,we=qe.substr(0,qe.lastIndexOf("/")+1);l.loadPathOf("flair.server",we);let ke=JSON.parse('{"envVars":{"vars":[],"options":{"overwrite":true}}}'),Ce=y("settingsReader");if("function"==typeof Ce){let e=Ce("flair.server");e&&(ke=pe([ke,e],!1))}ke=Object.freeze(ke);let Pe=JSON.parse("{}");return Pe=Object.freeze(Pe),l.context.current().currentAssemblyBeingLoaded("./flair.server{.min}.js"),await(async()=>{const{Payload:e}=await V("flair.app"),t=await f("path");c("ns","flair.api"),s("AttachmentPayload",e,function(){c("override"),this.construct=((e,s,i,r,a,n,o,l)=>{if(!this.file)throw K.InvalidArgument("file");e(s,i,r,l),this.file=s||"",this.displayName=a||t.basename(this.file),this.options=n||null,this.cb=o||null,this.resHeaders.push({name:"Content-disposition",value:`attachment;filename=${this.displayName||"unknown.unknown"}`})}),c("readonly"),this.file="",c("readonly"),this.displayName="",c("readonly"),this.options=null,c("readonly"),this.cb=null})})(),await(async()=>{const{Payload:e}=await V("flair.app");c("ns","flair.api"),s("BinaryPayload",e,function(){c("override"),this.construct=((e,t,s,i,r,a,n)=>{if(!t)throw K.InvalidArgument("data");this.buffer=Buffer.from(t,this.encoding),e(this.buffer,s,i,n),this.cb=a||null,this.resHeaders.push({name:"Content-disposition",value:`attachment;filename=${r||"unknown.unknown"}`}),this.resHeaders.push({name:"Content-Length",value:this.buffer.length})}),c("readonly"),this.buffer=null,c("readonly"),this.encoding="binary",c("readonly"),this.cb=null})})(),await(async()=>{const{Payload:e}=await V("flair.app");c("ns","flair.api"),s("JSONPayload",e,function(){c("override"),this.construct=((e,t,s,i,r)=>{if(!t)throw K.InvalidArgument("data");e(t,s,"application/json",r),this.isJsonP=i||!1}),c("readonly"),this.isJsonP=!1})})(),await(async()=>{const{HandlerResult:e}=await V("flair.app");c("ns","flair.api"),s("RestHandlerResult",e,function(){c("override"),this.construct=((e,t,s,i)=>{e(t,s,i)})})})(),await(async()=>{const{HandlerContext:e}=await V("flair.app");c("ns","flair.api"),s("RestHandlerContext",e,function(){c("override"),this.construct=((e,t,s)=>{e(),this.req=t,this.res=s}),c("readonly"),this.req=null,c("readonly"),this.res=null,this.redirect=((e,t,s,i)=>{throw this.setData("redirect-route",e),this.setData("redirect-status",t||302),this.setData("redirect-params",s||null),this.setData("redirect-query",i||null),K.Redirect(e)}),this.isHeadersSent={get:()=>this.res.headersSent},this.getResHeader=(e=>this.res.get(e)),this.setHeader=((e,t,s)=>{s?this.res.append(e,t):this.res.set(e,t)}),this.setCookie=((e,t,s)=>{this.res.cookie(e,t,s)}),this.clearCookie=((e,t)=>{this.res.clearCookie(e,t)}),this.isAjaxReq={get:()=>this.req.xhr},this.isStale={get:()=>this.req.stale},this.isFresh={get:()=>this.req.fresh},this.isSecure={get:()=>this.req.secure},this.url={get:()=>this.req.url},this.originalUrl={get:()=>this.req.originalUrl},this.baseUrl={get:()=>this.req.baseUrl},this.route={get:()=>this.req.route},this.ip={get:()=>this.req.ip},this.ips={get:()=>this.req.ips},this.hostName={get:()=>this.req.hostname},this.subDomains={get:()=>this.req.subdomains},this.protocol={get:()=>this.req.protocol},this.path={get:()=>this.req.path},this.method={get:()=>this.req.method},this.body={get:()=>this.req.body},this.params={get:()=>this.req.params},this.query={get:()=>this.req.query},this.isContentType=(e=>"string"==typeof this.req.is(e)),this.getHeader=(e=>this.req.get(e)),this.getCookie=((e,t)=>{if(t){if(this.req.signedCookies)return this.req.signedCookies[e]||null}else if(this.req.cookies)return this.req.cookies[e]||null;return null}),this.acceptsContentType=((...e)=>this.req.accepts(e)),this.acceptsCharset=((...e)=>this.req.acceptsCharsets(e)),this.acceptsEncoding=((...e)=>this.req.acceptsEncodings(e)),this.acceptsLanguage=((...e)=>this.req.acceptsLanguages(e))})})(),await(async()=>{const{Handler:e}=await V("flair.app"),{RestHandlerResult:t}=await V("flair.api");c("ns","flair.api"),s("RestHandler",e,function(){c("override"),this.construct=((e,t)=>{e(t)}),c("override"),this.run=(async(e,s,i)=>{e(s,i);let r=null,a=null,n=null,o,l;switch(s){case"get":n=this.onGet;break;case"post":n=this.onPost;break;case"put":n=this.onPut;break;case"patch":n=this.onPatch;break;case"delete":n=this.onDelete;break;case"head":n=this.onHead;break;case"options":n=this.onOptions;break;case"trace":n=this.onTrace;break}if(n)try{r=await n(i)}catch(e){a=e}else a=K.NotImplemented(`Verb ${s} is not implemented.`);return!!!a&&C(r,t)||(r=new t(a,r)),r}),c("protected"),c("virtual"),c("async"),this.onGet=Q,c("protected"),c("virtual"),c("async"),this.onPost=Q,c("protected"),c("virtual"),c("async"),this.onPut=Q,c("protected"),c("virtual"),c("async"),this.onPatch=Q,c("protected"),c("virtual"),c("async"),this.onDelete=Q,c("protected"),c("virtual"),c("async"),this.onHead=Q,c("protected"),c("virtual"),c("async"),this.onOptions=Q,c("protected"),c("virtual"),c("async"),this.onTrace=Q})})(),await(async()=>{c("ns","flair.api"),s("RestInterceptor",function(){c("virtual"),c("async"),this.run=Q})})(),await(async()=>{const{Bootware:e}=await V("flair.app");c("sealed"),c("ns","flair.boot"),s("NodeEnv",e,function(){c("override"),this.construct=(e=>{e("Node Server Environment")}),c("override"),this.boot=(async e=>{if(e(),ke.envVars.vars.length>0){const e=await f("node-env-file | x");if(e)for(let t of ke.envVars.vars)e(l.resolvePath(t),ke.envVars.options)}})})})(),l.context.current().currentAssemblyBeingLoaded("","function"==typeof onLoadComplete?onLoadComplete:null),l.registerAdo('{"name":"flair.server","file":"./flair.server{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.60.22","lupdate":"Wed, 25 Sep 2019 04:57:44 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.api.AttachmentPayload","flair.api.BinaryPayload","flair.api.JSONPayload","flair.api.RestHandlerResult","flair.api.RestHandlerContext","flair.api.RestHandler","flair.api.RestInterceptor","flair.boot.NodeEnv"],"resources":[],"assets":["main.js","start.js"],"routes":[]}'),Object.freeze({name:"flair.server",settings:ke,config:Pe})});