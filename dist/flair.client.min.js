/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.client
 *     File: ./flair.client.js
 *  Version: 0.60.9
 *  Tue, 24 Sep 2019 16:45:52 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(t,e){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>e):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e):t["flair.client"]=e}(this,async function(t,e){"use strict";const{Class:i,Struct:s,Enum:a,Interface:n,Mixin:r,Aspects:o,AppDomain:l,$$:h,attr:c,bring:u,Container:d,include:p,Port:m,on:f,post:w,telemetry:y,Reflector:g,Serializer:b,Tasks:v,as:$,is:x,isDefined:V,isComplies:A,isDerivedFrom:T,isAbstract:C,isSealed:W,isStatic:S,isSingleton:O,isDeprecated:E,isImplements:L,isInstanceOf:I,isMixed:N,getAssembly:R,getAttr:D,getContext:j,getResource:P,getRoute:H,getType:U,ns:k,getTypeOf:M,getTypeName:B,typeOf:q,dispose:F,using:z,Args:_,Exception:J,noop:G,nip:Y,nim:K,nie:Q,event:X}=t,{TaskInfo:Z}=t.Tasks,{env:tt}=t.options,{guid:et,stuff:it,replaceAll:st,splitAndTrim:at,findIndexByProp:nt,findItemByProp:rt,which:ot,isArrowFunc:lt,isASyncFunc:ht,sieve:ct,deepMerge:ut,getLoadedScript:dt,b64EncodeUnicode:pt,b64DecodeUnicode:mt,lens:ft,globalSetting:wt}=t.utils,yt=tt.isServer||tt.isWorker?null:(!0).document,gt=l.context.current().name,bt=e,vt=bt.substr(0,bt.lastIndexOf("/")+1);l.loadPathOf("flair.client",vt);let $t=JSON.parse('{"view":{"mainEl":"main","viewEl":"view","transition":"","layout":"","routes":{"home":"","notfound":""}},"i18n":{"lang":{"default":"en","locales":[{"code":"en","name":"English","native":"English"}]}},"routing":{"mounts":{"main":"/"},"all":{"before":{"settings":[{"name":"hashbang","value":false},{"name":"sensitive","value":false}],"interceptors":[]},"after":{"settings":[],"interceptors":[]}}}}'),xt=m("settingsReader");if("function"==typeof xt){let t=xt("flair.client");t&&($t=ut([$t,t],!1))}$t=Object.freeze($t);let Vt=JSON.parse('{"assetRoots":{"view":"views","layout":"layouts","content":"content","data":"data","style":"css"}}');return Vt=Object.freeze(Vt),l.context.current().currentAssemblyBeingLoaded("./flair.client{.min}.js"),await(async()=>{h("ns","flair.ui"),r("ViewComponentMembers",function(){let t={},e=et(),i=m("clientFile"),s="";h("protected"),this.name="",h("protected"),this.id="",h("protected"),this.inViewName="",h("protected"),this.html=null,h("protected"),this.style=null,h("protected"),this.data=null,h("protected"),this.baseName="",h("protected"),this.basePath="",h("protected"),this.localePath="",h("protected"),this.components={},h("protected"),this.i18n=null,h("private"),this.init=(async(t,i)=>{let a=null;if(s=t||"",this.inViewName=s,this.id=e,await this.beforeInit(i),this.name=this.name||i.getName(!0),!this.baseName){let t=i.getName(),e=t.substr(t.lastIndexOf(".")+1);this.baseName=e}return this.basePath||(this.basePath=i.getAssembly().assetsPath()),this.localePath||(this.localePath=i.getAssembly().localesPath()),await this.afterInit(i),a=await this.initContent(i),await this.assembleView(i),a}),h("private"),this.initContent=(async t=>{let s={title:null};const a=async()=>{this.html=await this.autoWire("view",this.html,t)},n=async()=>{this.style=await this.autoWire("style",this.style,t)},r=async()=>{this.data=await this.autoWire("data",this.data,t)},o=async()=>{if(this.html){let t=this.extractContent(this.html);t.html&&(this.html=t.html),t.title&&(s.title=t.title),t.i18n&&!this.i18n&&(this.i18n=t.i18n),t.style&&(this.style=t.style,await n()),t.data&&(this.data=t.data,await r())}this.html=`<div id="${e}">${this.html}</div>`},l=async()=>{if(this.style){let t=st(this.style,"#SCOPE_ID",`#${e}`);this.addStyle(t)}},h=async()=>{"string"==typeof this.data&&(this.data?this.data=JSON.parse(this.data):this.data=null)},c=async()=>{if(this.i18n){let e="";if("string"==typeof this.i18n){let t=this.i18n.split(",");this.i18n={};for(let e of t)this.i18n[e.trim()]=!1}let s=t.getAssembly(),a=this.locale();for(let t in this.i18n)this.i18n.hasOwnProperty(t)&&(e=this.i18n[t]||`./${t}.json`,s.hasLocale(a,e)?this.i18n[t]=await i(s.getLocale(a,e)):this.i18n[t]={})}};return await a(),await n(),await r(),await o(),await l(),await h(),await c(),s}),h("private"),this.load=(async(t,e)=>{await this.beforeLoad(t,e),await this.onLoad(t,e),await this.afterLoad(t,e)}),h("protected"),h("virtual"),this.onLoad=(async(t,e)=>{const{ViewComponent:i}=await k("flair.ui");e.innerHTML=this.html;let a=this.getComponents(e),n=null,r=null,o=null;for(let l of a)this.components[l.name]||(n=e.querySelector(`[id="${l.id}"]`))&&(r=$(await p(l.type),i))&&(o=new r)&&(this.components[l.name]=await o.view(s,t,n,l.params));this.html=e.innerHTML}),h("protected"),this.getComponents=(t=>{let e=[];if(t){let i;e=this.extractComponents(t).components}else{let t;e=this.extractContent(this.html).elements.components}return e}),h("private"),this.addStyle=((t,i)=>{if(t){let a=(!0).document.createElement("style");a.id=i||`${e}`,a.owner=s,a.type="text/css",a.appendChild((!0).document.createTextNode(t)),(!0).document.head.appendChild(a)}}),h("private"),this.autoWire=(async(t,e,s,a)=>{let n=e,r=null,o=null;const h=async()=>{n&&"object"==typeof n&&n.data&&(n=n.data)},c=async e=>{n||(r=`${s.getName()}_${e}`,s.getAssembly().hasResource(r)&&(o=l.context.current().getResource(r),n=o&&o.data?o.data:"")),n||(r=ot(`./${Vt.assetRoots[t]}/${s.getName()}.${e}`),s.getAssembly().hasAsset(r)&&(n=s.getAssembly().getAsset(r)))},u=async e=>{"string"==typeof n&&""!==n&&(n.startsWith("res:")&&(n=n.substr(4),s.getAssembly().hasResource(n)&&(o=l.context.current().getResource()||null,n=o&&o.data?o.data:"")),n.startsWith("ast:")&&((n=n.substr(4)).startsWith("./")||(n="./"+n),s.getAssembly().hasAsset(n)&&(n=s.getAssembly().getAsset(n))),n.startsWith("./")&&(n.endsWith(`.${t}.${e}`)||n.endsWith(`.${t}{.min}.${e}`))&&(r=ot(`./${Vt.assetRoots[t]}/${s.getName()}.${e}`),s.getAssembly().hasAsset(r)&&(n=s.getAssembly().getAsset(r))),n.startsWith("./")&&n.endsWith(`.${e}`)&&s.getAssembly().hasAsset(n)&&(n=s.getAssembly().getAsset(n)),n.startsWith("./")&&(n=await i(n)))},d=async()=>{await h(),n||(n=$t.view.layout),await u("html"),n||(n=`<div type="${a}"></div>`)},p=async()=>{await h(),await c("html"),await u("html"),n||(n=`<div>\x3c!-- view markup not defined / could not be resolved --\x3e</div>`)},m=async()=>{await h(),await c("css"),await u("css"),n||(n=``)},f=async()=>{await h(),await c("json"),await u("json"),n||(n={})};switch(t){case"layout":await d();break;case"view":await p();break;case"style":await m();break;case"data":await f();break}return n}),h("private"),this.extractContent=(t=>{let e=null,i={title:null,i18n:null,html:null,style:null,data:null,elements:{components:[],view:null},updatedHtml:()=>e.body.innerHTML},s=new(!0).DOMParser,a=(e=s.parseFromString(t,"text/html")).getElementsByTagName("script");if(a)for(let t of a)t.parentNode.removeChild(t);let n=e.getElementsByTagName("link");if(n)for(let t of n)t.parentNode.removeChild(t);let r=e.getElementsByTagName("style");if(r&&r.length>0){let t=r[0];if(i.style=t.innerHTML.trim(),!i.style){let e=t.getAttribute("src");e&&(e.startsWith("~/")&&(e=e.replace("~/","./")),i.style=e)}for(let t of r)t.parentNode.removeChild(t)}let o=e.getElementsByTagName("data");if(o&&o.length>0){let t=o[0];if(i.data=t.innerHTML.trim(),!i.data){let e=t.getAttribute("src");e&&(e.startsWith("~/")&&(e=e.replace("~/","./")),i.data=e)}for(let t of o)t.parentNode.removeChild(t)}i.elements=this.extractComponents(e.body),i.html=(e.body.innerHTML||"").trim(),i.html=st(i.html,"./",this.basePath),i.html=st(i.html,"~/","./");let l=i.html.match(/('|")@\w*./g);l&&Array.isArray(l)&&l.length>0&&(i.i18n="",l.forEach(t=>{i.i18n+=","+t.substr(2,t.length-3)}),i.i18n.startsWith(",")&&(i.i18n=i.i18n.substr(1)));let h=e.getElementsByTagName("html");if(h&&h.length>0){let t=(h=h[0]).getAttribute("title");if(t&&(i.title=t,t.startsWith("@"))){let e=t.substr(1).split(".")[0];e&&(i.i18n?-1===i.i18n.indexOf(e)&&(i.i18n+=","+e):i.i18n=e)}}return i}),h("private"),this.extractComponents=(t=>{let e={components:[],view:null},i=t.querySelectorAll("div[ctype]");if(i){let t="",s=$t.view.viewEl||"view";for(let a of i)if(""!==(t=a.getAttribute("ctype")))if(t===s)e.view||(e.view=a);else{let t=a.getAttribute("id"),i=a.getAttribute("ctype")||"",s=a.getAttribute("params")||"",n=a.getAttribute("name");t||(t=et(),a.setAttribute("id",t)),n||(n=st(i,".","_"),a.setAttribute("name",n)),e.components.push({id:t,name:n,type:i,params:s})}}return e}),h("protected"),this.locale=(t=>l.host().locale(t,!0)),h("protected"),this.version=(t=>l.host().version(t,!0)),h("protected"),this.pathToUrl=((t,e,i)=>l.host().pathToUrl(t,e,i)),h("protected"),this.routeToUrl=((t,e,i)=>l.host().routeToUrl(t,e,i)),h("protected"),this.i18nValue=(t=>{let e=t||"",i=tt.isDebug?":":"";if(t&&t.startsWith("@")){let s=(t=t.substr(1)).split("|");t=s[0].trim(),e=s[1].trim()||"",this.i18n&&(e=ft(this.i18n,t)||i+e+i)}return e||"(i18n: 404)"}),h("protected"),this.cancelLoadData=(async()=>{let e=null;for(let i in t)if(t.hasOwnProperty(i))try{(e=t[i])&&e.abort()}catch(t){}t={}}),h("protected"),this.abortHandle=(e=>{e=e||et();let i=new AbortController;return t[e]=i,i}),h("protected"),this.abort=(e=>{try{let i;t[e].abort()}catch(t){}}),h("protected"),h("virtual"),h("async"),this.beforeLoad=G,h("protected"),h("virtual"),h("async"),this.afterLoad=G,h("protected"),h("virtual"),h("async"),this.preloadData=G,h("protected"),h("virtual"),h("async"),this.loadData=G})})(),await(async()=>{const{HandlerContext:t}=await k("flair.app"),e=function(t){this.tld=t,this.set=((t,i,s)=>{let a={[t]:i,path:"/"};if(s){let t=new Date;t.setTime(t.getTime()+24*s*60*60*1e3),a.expires=t.toUTCString()}e.tld&&(a.domain="."+(!0).location.hostname.split(".").slice(-2).join("."));let n=[];for(let t in a)n.push(`${t}=${a[t]}`);return document.cookie=n.join("; "),this.get(t)}),this.getAll=(()=>{let t={};return document.cookie.split(";").forEach(e=>{let[i,s]=e.split("=");t[i.trim()]=s}),t}),this.get=(t=>this.getAll()[t]),this.delete=(t=>{this.set(t,"",-1)}),this.deleteAll=(()=>{let t=this.getAll();for(let e in t)this.delete(e)})};h("ns","flair.ui"),i("ViewHandlerContext",t,function(){h("override"),this.construct=((t,e)=>{t(),this.ctx=e}),h("readonly"),this.ctx=null,this.redirect=((t,e,i)=>{throw this.setData("redirect-route",t),this.setData("redirect-params",e||null),this.setData("redirect-query",i||null),J.Redirect(t)}),this.isSecure={get:()=>{this.protocol}},this.readyState={get:()=>(!0).document.readyState},this.characterSet={get:()=>(!0).document.characterSet},this.url={get:()=>(!0).document.location.href},this.originalUrl={get:()=>this.ctx.$url},this.baseUrl={get:()=>this.ctx.$mount},this.route={get:()=>this.ctx.$route},this.origin={get:()=>(!0).document.location.origin},this.hostName={get:()=>(!0).document.location.hostname},this.port={get:()=>(!0).document.location.port},this.protocol={get:()=>(!0).document.location.protocol},this.path={get:()=>this.ctx.$path},this.hash={get:()=>(!0).document.location.hash},this.handler={get:()=>this.ctx.$handler},this.locale={get:()=>this.ctx.$locale},this.version={get:()=>this.ctx.$version},this.params={get:()=>this.ctx.$params},this.query={get:()=>this.ctx.$query},this.cookie=Object.freeze(new e(!0))})})(),await(async()=>{h("ns","flair.ui"),i("ViewTransition",function(){h("virtual"),h("async"),this.enter=G,h("virtual"),h("async"),this.leave=G})})(),await(async()=>{const{Handler:t}=await k("flair.app");h("ns","flair.ui"),i("ViewHandler",t,function(){h("override"),this.construct=((t,e)=>{t(e)}),h("override"),this.run=(async(t,e)=>{t("view",e),await this.onView(e)}),h("protected"),h("virtual"),h("async"),this.onView=G})})(),await(async()=>{const{ViewHandler:t,ViewTransition:e,ViewComponentMembers:s}=await k("flair.ui");h("ns","flair.ui"),i("View",t,[s],function(){let t="",i="";h("override"),this.construct=((e,s)=>{e(s),t=$t.view.mainEl||"main",i=$t.view.viewEl||"view",this.viewTransition=$t.view.transition||""}),h("privateSet"),this.viewTransition="",h("protected"),this.layout="",h("protectedSet"),this.title="",h("protectedSet"),this.meta=null,h("protected"),h("override"),h("sealed"),this.onView=(async(e,i)=>{this.$static.outView=this.$static.currentView,this.$static.inView=this,e(i),this.name=this.name||this.$Type.getName(!0);let s=await this.init(this.$static.inView.name,this.$Type);s&&s.title&&(this.title=s.title);let a=null,n=yt.getElementById(t);if(this.$static.outView&&this.$static.outView.name===this.$static.inView.name?a=yt.getElementById(this.name):((a=yt.createElement("div")).id=this.name,a.setAttribute("hidden",""),n.appendChild(a)),await this.load(i,a),await this.preloadData(i),await this.swap(),this.loadData(i),this.$static.outView&&this.$static.outView.name!==this.$static.inView.name){let t=document.head.getElementsByTagName("style");if(t&&t.length>0){let e="";for(let i of t)(e=i.getAttribute("owner")||"")===this.$static.outView.name&&i.parentNode.removeChild(i)}}this.$static.outView=null,this.$static.inView=null}),h("protected"),this.assembleView=(async t=>{const e=async()=>{this.layout=await this.autoWire("layout",this.layout,t,i)},s=async()=>{let t=this.extractContent(this.layout);if(t.style){let e=`${this.id}_LAYOUT`,i=st(t.style,"#SCOPE_ID",`#${e}`);this.addStyle(i,e)}t.html&&(t.elements.view&&(t.elements.view.innerHTML=this.html),this.html=t.updatedHtml())};await e(),await s()}),h("private"),this.swap=(async()=>{let e=yt.getElementById(this.name);if(this.$static.outView){let i=yt.getElementById(this.$static.outView.name);if(this.$static.outView.name!==this.$static.inView.name){if(this.$static.outView.meta)for(let t of this.$static.outView.meta)yt.head.removeChild(yt.querySelector('meta[name="'+t+'"]'));this.viewTransition?(await this.viewTransition.leave(i,e),await this.viewTransition.enter(e,i)):(i&&(i.hidden=!0),e.hidden=!1);let s=yt.getElementById(t);i&&s.removeChild(i)}}if(!this.$static.outView||this.$static.outView.name!==this.$static.inView.name){if(this.meta)for(let t of this.meta){var i=document.createElement("meta");for(let e in t)i[e]=t[e];yt.head.appendChild(i)}!this.$static.outView&&e&&(e.hidden=!1)}this.title=this.i18nValue(this.title),yt.title=this.title,this.$static.currentView=this}),h("protected"),h("virtual"),this.beforeInit=(async t=>{if(this.viewTransition){let t=$(await p(this.viewTransition),e);this.viewTransition=t?new t:""}}),h("protected"),h("virtual"),this.afterInit=(async t=>{}),h("static"),this.currentView=null,h("static"),this.inView=null,h("static"),this.outView=null})})(),await(async()=>{const{ViewComponentMembers:t}=await k("flair.ui");h("ns","flair.ui"),i("ViewComponent",[t],function(){let t="";this.view=(async(e,i,s,a)=>(t=e||"","string"==typeof a?(a=a.trim()).startsWith("[")&&this.params.endsWith("]")||a.startsWith("{")&&this.params.endsWith("}")?this.params=JSON.params(a):this.params=a.split(","):"object"==typeof a&&(this.params=a),await this.loadView(i,s),this.viewComponentObject||this)),h("protected"),this.params=null,h("protected"),this.viewComponentObject=null,h("protected"),this.loadView=(async(e,i)=>{await this.init(t,this.$Type),await this.load(e,i),await this.preloadData(e),this.loadData(e)}),h("protected"),h("virtual"),h("async"),this.assembleView=G,h("protected"),h("virtual"),h("async"),this.beforeInit=G,h("protected"),h("virtual"),h("async"),this.afterInit=G})})(),await(async()=>{h("sealed"),h("ns","flair.ui"),i("Page",function(){let t=[],e=null;this.construct=((t,e)=>{this.params=e||"",this.hasbang=t.hasbang||!1,this.base=t.base||"",this.sensitive=t.sensitive||!1,this.base.endsWith("/")&&(this.base=this.base.substr(0,this.base.length-1)),this.base.startsWith("/")||(this.base="/"+this.base)}),h("readonly"),this.hasbang=!1,h("readonly"),this.params="",h("readonly"),this.base="",h("readonly"),this.sensitive=!1,h("private"),this.pathToRegExp=((t,e)=>{t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1));let i=t?t.split("/"):[],s="",a=0;for(let t of i)(t=t.trim()).startsWith(":")?(e.push({name:t.substr(1),index:a}),s+="/.[^/]*"):s+="/"+t,a++;s+="/";let n=null;return n=this.sensitive?new RegExp(s):new RegExp(s,"i")}),this.breakUrl=(e=>{let i={url:e,path:"",locale:"",version:"",params:{},query:{},handler:null,route:null},s=e;"/"===s.substr(0,1)&&(s=s.substr(1)),"#!/"===s.substr(0,3)&&(s=s.substr(3)),"#!"===s.substr(0,2)&&(s=s.substr(2)),"#/"===s.substr(0,2)&&(s=s.substr(2)),"#"===s.substr(0,1)&&(s=s.substr(1)),"/"===s.substr(0,1)&&(s=s.substr(1)),(s="/"+s).startsWith(this.base)&&(s=s.substr(this.base.length)),s.startsWith("/")||(s="/"+s);let a=s.indexOf("?"),n="",r=null;if(-1!==a){n=s.substr(a+1),s=s.substr(0,a);let t=n.split("&"),e=null;for(let i of t)e=i.split("="),(r=r||{})[e[0].trim()]=e[1]?decodeURIComponent(e[1].trim()):"";r&&(i.query=r)}s.endsWith("/")||(s+="/"),i.path=s;for(let e of t){let t=e.regex.exec(decodeURIComponent(s));if(t&&t.input===t[0]){s.startsWith("/")&&(s=s.substr(1)),s.endsWith("/")&&(s=s.substr(0,s.length-1));let t=s?s.split("/"):[];for(let s of e.keys)i.params[s.name]=t[s.index];if(i.handler=e.handler,i.route=e.route,this.params){let t="";t=":version",-1!==this.params.indexOf(t)&&i.params["version"]&&(i.version=i.params["version"]),t=":locale",-1!==this.params.indexOf(t)&&i.params["locale"]&&(i.locale=i.params["locale"])}break}}return i}),this.buildUrl=((t,e,i)=>{let s=this.base;if(s.endsWith("/")||(s+="/"),this.params){let t=this.params;t.startsWith("/")&&(t=t.substr(1)),s+=t,e=e||{};let i="";i=":version",-1!==t.indexOf(i)&&(e["version"]=l.host().version()),i=":locale",-1!==t.indexOf(i)&&(e["locale"]=l.host().locale())}t.startsWith("/")&&(t=t.substr(1)),(s+=t).startsWith("/")||(s="/"+s),(s=this.hasbang?"#!"+s:"#"+s).endsWith("/")||(s+="/");let a=!1;if(e){let t=-1,i="?",n=null;for(let a in e)e.hasOwnProperty(a)&&(t=s.indexOf(`:${a}`),n=encodeURIComponent(e[a].toString()),-1!==t?s=st(s,`:${a}`,n):i+=`${a}=${n}&`);"?"!==i&&(a=!0,i.endsWith("&")&&(i=i.substr(0,i.length-1)),s+=i)}if(i){let t=a?"&":"?",e=null;for(let s in i)i.hasOwnProperty(s)&&(t+=`${s}=${e=encodeURIComponent(i[s].toString())}&`);"?"!==t&&"&"!==t&&(s+=t)}return s}),this.add=((e,i)=>{let s=e.path;if(this.params){let t=this.params;t.startsWith("/")||(t="/"+t),t.endsWith("/")||(t+="/"),s=(t+=s).replace("//","/")}let a=[];t.push({route:e,path:s,keys:a,regex:this.pathToRegExp(s,a),handler:i})}),this.add404=(t=>{e=t}),this.run=(async t=>{let i=this.breakUrl(t),s={$url:t,$route:"",$handler:"",$mount:"",$path:i.path||"",$locale:i.locale||"",$version:i.version||"",$params:i.params||{},$query:i.query||{}};i.route&&(s.$route=i.route.name,s.$handler=i.route.handler,s.$mount=i.route.mount,s.$path=i.route.path);try{i.handler?(i.locale&&l.host().locale(i.locale),i.version&&l.host().version(i.version),await i.handler(s)):await e(s)}catch(t){l.host().raiseError(t)}})})})(),await(async()=>{const{Bootware:t,HandlerResult:e}=await k("flair.app"),{ViewInterceptor:s,ViewHandler:a,ViewHandlerContext:n}=await k("flair.ui");h("sealed"),h("ns","flair.boot"),i("ClientRouter",t,function(){let t=null;h("override"),this.construct=(t=>{t("Client Router",!0)}),h("override"),this.boot=(async(i,r)=>{i(),t||(t=l.context.current().allRoutes(!0)).sort((t,e)=>t.index<e.index?-1:t.index>e.index?1:0);const o=(t,e)=>{if(302===t.status){let t=e.getData("redirect-route"),i=e.getData("redirect-params"),s=e.getData("redirect-query");setTimeout(()=>{l.host().redirect(t,i,s)},0)}},h=async t=>{let e=this.getMountSpecificSettings("interceptors",$t.routing,r.name);for(let i of e){let e=$(await p(i),s);if(!e)throw J.InvalidDefinition(`Invalid interceptor type. (${i})`);await(new e).run(t)}},c=async(t,e,i)=>{let s=$(await p(e),a);if(!s)throw J.InvalidDefinition(`Invalid route handler. (${e})`);{let e=new s(t);await e.run(i)}},u=t=>"string"==typeof t.handler?t.handler:t.handler[l.app().getRoutingContext(t.name)]||t.handler.default||"",d=t=>async i=>{let s=new n(i);const a=t=>{let i=new e(t);o(i,s)},r=async()=>{let e=u(t);if(!e)throw J.NotDefined(t);await c(t,e,s)};h(s).then(()=>{r().then(()=>{let t=e(null,!0);o(t,s)}).catch(a)}).catch(a)},m=(t,e)=>{t.add(e,d(e))};let f=r.app;for(let e of t)("string"==typeof e.mount&&e.mount===r.name||-1!==e.mount.indexOf(r.name))&&e.name!==$t.view.routes.notfound&&m(f,e);f.add404(async t=>{let e=new n(t),i=$t.view.routes.notfound;if(i&&(i=l.context.current().getRoute(i)),!i)return alert(`404: ${e.originalUrl} not found.`),void setTimeout(()=>{(!0).history.back()},0);let s=u(i);await c(i,s,e)})})})})(),await(async()=>{const{Host:t}=await k("flair.app"),{Page:e}=await k("flair.ui");h("sealed"),h("ns","flair.app"),i("ClientHost",t,function(){let t={},i=null;h("override"),this.construct=(t=>{t("Client"),this.currentLocale=this.defaultLocale}),this.app={get:()=>this.mounts["main"].app,set:G},this.mounts={get:()=>t,set:G},h("state"),h("private"),this.currentLocale="",this.defaultLocale={get:()=>$t.i18n.lang.default,set:G},this.supportedLocales={get:()=>$t.i18n.lang.locales.slice(),set:G},this.locale=((t,e)=>{if(t&&this.currentLocale!==t&&-1!==nt(this.supportedLocales,"code",t)){let i=this.currentLocale;if(this.currentLocale=t,tt.props("api","locale".newLocale),e){let e=(!0).location.hash.replace(i,t);this.go(e)}}return this.currentLocale}),h("state"),h("private"),this.currentVersion="",this.version=((t,e)=>{if(t&&this.currentVersion!==t){let i=this.currentVersion;if(this.currentVersion=t,tt.props("api","version".newVersion),e){let e=(!0).location.hash.replace(i,t);this.go(e)}}return this.currentVersion}),this.routeToUrl=((t,e,i)=>{if(!t)return null;let s=l.context.current().getRoute(t),a;return s?this.mounts[s.mount].app.buildUrl(s.path,e,i):st(t,".","_")}),this.pathToUrl=((t,e,i)=>{let s;return this.urlToApp(t).buildUrl(t,e,i)}),h("private"),this.urlToApp=(t=>{"#!/"===t.substr(0,3)&&(t=t.substr(3)),"#!"===t.substr(0,2)&&(t=t.substr(2)),t.startsWith("/")||(t="/"+t);let e=null;for(let i in this.mounts)this.mounts.hasOwnProperty(i)&&t.startsWith(i.base)&&i.base.length>e.base.length&&(e=i);return e?e.app:this.app}),this.redirect=(async(t,e,i,s)=>{await this.navigate(t,e,i,!0),s&&await this.refresh()}),this.navigate=(async(t,e,i,s)=>{e=e||{};let a=this.routeToUrl(t,e,i);a?await this.go(a,s):this.raiseError(J.NotFound(t,this.navigate))}),this.go=(async(t,e)=>{e?"#/"!==t&&history.replaceState(null,null,(!0).document.location.pathname+t):("#"===t.substr(0,1)&&(t=t.substr(1)),window.location.hash=t)}),this.refresh=(async()=>{setTimeout(()=>{i()},0)}),h("override"),this.boot=(async i=>{i();let s={},a=null,n="";const r=t=>{let e=this.getMountSpecificSettings("settings",$t.routing,t,"name");if(e&&e.length>0)for(let t of e)s[t.name]=t.value;return s.base=$t.routing.mounts[t],s};s=r("main");let o=($t.routing["main"]?$t.routing["main"]["params"]:"")||"",l=new e(s,o);for(let i of Object.keys($t.routing.mounts))"main"===i?(a=l,n=o):(s=r(i),n=($t.routing[i]?$t.routing[i]["params"]:"")||"",a=new e(s,n)),t[i]=Object.freeze({name:i,root:a.base,params:n,app:a});t=Object.freeze(t)}),h("override"),this.start=(async t=>{t(),i=(async()=>{let t=this.urlToApp((!0).location.hash);await t.run((!0).location.hash)})}),h("override"),this.ready=(async t=>{t(),(!0).addEventListener("hashchange",i),(!0).location.hash?await i():$t.view.routes.home?await this.redirect($t.view.routes.home,{},{},!0):console.log(`No home route is configured.`),console.log(`${l.app().info.name}, v${l.app().info.version}`)}),h("override"),this.stop=(async t=>{t(),(!0).removeEventListener("hashchange",i)}),h("override"),this.dispose=(e=>{e(),t=null})})})(),await(async()=>{h("ns","flair.ui"),i("ViewInterceptor",function(){h("virtual"),h("async"),this.run=G})})(),await(async()=>{h("singleton"),h("ns","flair.ui"),i("ViewState",function(){h("state"),h("private"),this.store={},this.get=((t,e)=>(t=t||"",e=e||"",this.store[t+"/"+e]||null)),this.set=((t,e,i)=>{t=t||"",e=e||"","boolean"==typeof i||i?this.store[t+"/"+e]=i:delete this.store[t+"/"+e]}),this.clear=(()=>{this.store=null})})})(),l.context.current().currentAssemblyBeingLoaded("","function"==typeof onLoadComplete?onLoadComplete:null),l.registerAdo('{"name":"flair.client","file":"./flair.client{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.60.9","lupdate":"Tue, 24 Sep 2019 16:45:52 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.ui.ViewComponentMembers","flair.ui.ViewHandlerContext","flair.ui.ViewTransition","flair.ui.ViewHandler","flair.ui.View","flair.ui.ViewComponent","flair.ui.Page","flair.boot.ClientRouter","flair.app.ClientHost","flair.ui.ViewInterceptor","flair.ui.ViewState"],"resources":[],"assets":["index.html","index.js","start.js"],"routes":[]}'),Object.freeze({name:"flair.client",settings:$t,config:Vt})});