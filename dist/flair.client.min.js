/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.client
 *     File: ./flair.client.js
 *  Version: 0.59.21
 *  Sun, 08 Sep 2019 20:50:36 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(t,e){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>e):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e):t["flair.client"]=e}(this,async function(t,e){"use strict";const{Class:i,Struct:s,Enum:a,Interface:r,Mixin:n,Aspects:o,AppDomain:l,$$:c,attr:h,bring:u,Container:d,include:p,Port:f,on:m,post:w,telemetry:g,Reflector:$,Serializer:v,Tasks:b,as:y,is:V,isDefined:x,isComplies:S,isDerivedFrom:T,isAbstract:C,isSealed:L,isStatic:O,isSingleton:E,isDeprecated:I,isImplements:N,isInstanceOf:W,isMixed:R,getAssembly:A,getAttr:D,getContext:j,getResource:k,getRoute:B,getType:U,ns:F,getTypeOf:M,getTypeName:P,typeOf:H,dispose:z,using:_,Args:J,Exception:q,noop:G,nip:K,nim:Q,nie:X,event:Y}=t,{TaskInfo:Z}=t.Tasks,{env:tt}=t.options,{guid:et,stuff:it,replaceAll:st,splitAndTrim:at,findIndexByProp:rt,findItemByProp:nt,which:ot,isArrowFunc:lt,isASyncFunc:ct,sieve:ht,deepMerge:ut,getLoadedScript:dt,b64EncodeUnicode:pt,b64DecodeUnicode:ft,lens:mt,globalSetting:wt}=t.utils,{$$static:gt,$$abstract:$t,$$virtual:vt,$$override:bt,$$sealed:yt,$$private:Vt,$$privateSet:xt,$$protected:St,$$protectedSet:Tt,$$readonly:Ct,$$async:Lt,$$overload:Ot,$$enumerate:Et,$$dispose:It,$$post:Nt,$$on:Wt,$$timer:Rt,$$type:At,$$args:Dt,$$inject:jt,$$resource:kt,$$asset:Bt,$$singleton:Ut,$$serialize:Ft,$$deprecate:Mt,$$session:Pt,$$state:Ht,$$conditional:zt,$$noserialize:_t,$$ns:Jt}=c,qt=tt.isServer||tt.isWorker?null:(!0).document,Gt=l.context.current().name,Kt=e,Qt=Kt.substr(0,Kt.lastIndexOf("/")+1);l.loadPathOf("flair.client",Qt);let Xt=JSON.parse('{"view":{"el":"main","transition":"","static":{"fileExt":"xml","root":"./pages/","handler":"flair.ui.StaticView"},"routes":{"home":"","notfound":""}},"i18n":{"lang":{"default":"en","locales":[{"code":"en","name":"English","native":"English"}]}},"routing":{"mounts":{"main":"/"},"all":{"before":{"settings":[{"name":"hashbang","value":false},{"name":"sensitive","value":false}],"interceptors":[]},"after":{"settings":[],"interceptors":[]}}}}'),Yt=t.Port("settingsReader");if("function"==typeof Yt){let t=Yt("flair.client");t&&(Xt=ut([Xt,t],!1))}Xt=Object.freeze(Xt);let Zt=JSON.parse("{}");return Zt=Object.freeze(Zt),l.context.current().currentAssemblyBeingLoaded("./flair.client{.min}.js"),await(async()=>{c("ns","flair.ui"),i("ViewTransition",function(){c("virtual"),c("async"),this.enter=G,c("virtual"),c("async"),this.leave=G})})(),await(async()=>{const{Handler:t}=await F("flair.app"),{ViewTransition:e}=await F("flair.ui");c("ns","flair.ui"),i("ViewHandler",t,function(){let t="",i={};c("override"),this.construct=((e,i)=>{e(),t=Xt.view.el||"main",this.viewTransition=Xt.view.transition||"","string"==typeof i&&(this.isStatic=!0,this.staticRoot=Xt.view.static.root||"./pages/",this.staticFile=i.replace("./",this.staticRoot))}),c("readonly"),this.isStatic=!1,c("readonly"),this.staticFile="",c("protected"),c("readonly"),this.staticRoot="",c("privateSet"),this.viewTransition="",c("protectedSet"),this.name="",c("protectedSet"),this.title="",c("protectedSet"),this.meta=null,c("protected"),c("virtual"),c("async"),this.loadStaticFile=G,c("protected"),c("virtual"),c("async"),this.beforeLoad=G,c("protected"),c("virtual"),c("async"),this.afterLoad=G,c("protected"),c("virtual"),c("async"),this.loadData=G,c("protected"),this.cancelLoadData=(async()=>{let t=null;for(let e in i)try{(t=i[e]).abort()}catch(t){}i={},await this.onCancelLoadData()}),c("protected"),this.abortHandle=(t=>{t=t||et();let e=new AbortController;return i[t]=e,e}),c("protected"),this.abort=(t=>{try{let e;i[t].abort()}catch(t){}}),c("protected"),c("virtual"),c("async"),this.onCancelLoadData=G,this.view=(async i=>{if(this.name=this.name||this.$Type.getName(!0),this.$static.loadingViewName=this.name,this.viewTransition){let t=y(await p(this.viewTransition),e);this.viewTransition=t?new t:""}let s=null,a=qt.getElementById(t);this.$static.currentViewName!==this.name?((s=qt.createElement("div")).id=this.name,s.setAttribute("hidden",""),a.appendChild(s)):s=qt.getElementById(this.name),this.isStatic&&await this.loadStaticFile(i),await this.beforeLoad(i,s),await this.onView(i,s),await this.afterLoad(i,s),await this.swap(),this.loadData(i)}),c("protected"),c("virtual"),c("async"),this.onView=G,c("private"),this.swap=(async()=>{let e=qt.getElementById(this.name);if(this.$static.currentViewName){let i=qt.getElementById(this.$static.currentViewName);if(this.$static.currentViewCancelLoadData(),this.$static.currentViewName!==this.name){if(this.$static.currentViewMeta)for(let t of this.$static.currentViewMeta)qt.head.removeChild(qt.querySelector('meta[name="'+t+'"]'));this.$static.removeStyles(),this.viewTransition?(await this.viewTransition.leave(i,e),await this.viewTransition.enter(e,i)):(i&&(i.hidden=!0),e.hidden=!1);let s=qt.getElementById(t);i&&s.removeChild(i)}}if(this.$static.currentViewName!==this.name){if(this.meta)for(let t of this.meta){var i=document.createElement("meta");for(let e in t)i[e]=t[e];qt.head.appendChild(i)}!this.$static.currentViewName&&e&&(e.hidden=!1)}qt.title=this.title,this.$static.currentViewName=this.name,this.$static.loadingViewName=null,this.$static.currentViewMeta=this.meta,this.$static.currentViewCancelLoadData=this.cancelLoadData}),c("static"),this.currentViewName=null,c("static"),this.currentViewMeta=null,c("static"),this.currentViewCancelLoadData=null,c("static"),this.loadingViewName=null,c("static"),this.removeStyles=function(){if(this.currentViewName){let t=document.head.getElementsByTagName("style"),e=this.currentViewName;for(let i of t)i.id&&i.id.startsWith(`_${e}_style_`)&&document.head.removeChild(i)}},c("static"),this.addStyle=function(t,e){if(this.loadingViewName){let i=(!0).document.createElement("style");i.id=`_${this.loadingViewName}_style_${t}`,i.type="text/css",i.appendChild((!0).document.createTextNode(e)),(!0).document.head.appendChild(i)}}})})(),await(async()=>{c("sealed"),c("ns","flair.ui"),i("Page",function(){let t=[],e;this.construct=((t,e)=>{this.params=e||"",this.hasbang=t.hasbang||!1,this.base=t.base||"",this.sensitive=t.sensitive||!1,this.base.endsWith("/")&&(this.base=this.base.substr(0,this.base.length-1)),this.base.startsWith("/")||(this.base="/"+this.base)}),c("readonly"),this.hasbang=!1,c("readonly"),this.params="",c("readonly"),this.base="",c("readonly"),this.sensitive=!1,c("private"),this.pathToRegExp=((t,e)=>{t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1));let i=t?t.split("/"):[],s="",a=0;for(let t of i)(t=t.trim()).startsWith(":")?(e.push({name:t.substr(1),index:a}),s+="/.[^/]*"):s+="/"+t,a++;s+="/";let r=null;return r=this.sensitive?new RegExp(s):new RegExp(s,"i")}),this.breakUrl=(e=>{let i={url:e,path:"",locale:"",version:"",params:{},handler:null,route:null},s=e;"/"===s.substr(0,1)&&(s=s.substr(1)),"#!/"===s.substr(0,3)&&(s=s.substr(3)),"#!"===s.substr(0,2)&&(s=s.substr(2)),"#/"===s.substr(0,2)&&(s=s.substr(2)),"#"===s.substr(0,1)&&(s=s.substr(1)),"/"===s.substr(0,1)&&(s=s.substr(1)),(s="/"+s).startsWith(this.base)&&(s=s.substr(this.base.length)),s.startsWith("/")||(s="/"+s);let a=s.indexOf("?"),r="",n=null;if(-1!==a){r=s.substr(a+1),s=s.substr(0,a);let t=r.split("&"),e=null;for(let i of t)e=i.split("="),(n=n||{})[e[0].trim()]=decodeURIComponent(e[1].trim())}s.endsWith("/")||(s+="/"),i.path=s;for(let e of t){let t=e.regex.exec(decodeURIComponent(s));if(t&&t.input===t[0]){s.startsWith("/")&&(s=s.substr(1)),s.endsWith("/")&&(s=s.substr(0,s.length-1));let t=s?s.split("/"):[];for(let s of e.keys)i.params[s.name]=t[s.index];if(i.handler=e.handler,i.route=e.route,this.params){let t="";t=":version",-1!==this.params.indexOf(t)&&i.params["version"]&&(i.version=i.params["version"]),t=":locale",-1!==this.params.indexOf(t)&&i.params["locale"]&&(i.locale=i.params["locale"])}break}}return n&&(i.params=Object.assign(i.params,n)),i}),this.buildUrl=((t,e)=>{let i=this.base;if(i.endsWith("/")||(i+="/"),this.params){let t=this.params;t.startsWith("/")&&(t=t.substr(1)),i+=t,e=e||{};let s="";s=":version",-1!==t.indexOf(s)&&(e["version"]=l.host().version()),s=":locale",-1!==t.indexOf(s)&&(e["locale"]=l.host().locale())}if(t.startsWith("/")&&(t=t.substr(1)),(i+=t).startsWith("/")||(i="/"+i),(i=this.hasbang?"#!"+i:"#"+i).endsWith("/")||(i+="/"),e){let t=-1,s="?",a=null;for(let r in e)e.hasOwnProperty(r)&&(t=i.indexOf(`:${r}`),a=encodeURIComponent(e[r].toString()),-1!==t?i=st(i,`:${r}`,a):s+=`${r}=${a}`);"?"!==s&&(i+=s)}return i}),this.add=((e,i)=>{let s=e.path;if(this.params){let t=this.params;t.startsWith("/")||(t="/"+t),t.endsWith("/")||(t+="/"),s=(t+=s).replace("//","/")}let a=[];t.push({route:e,path:s,keys:a,regex:this.pathToRegExp(s,a),handler:i})}),this.add404=(t=>{e=t}),this.run=(async t=>{let i={$url:t,$page:"",$route:"",$handler:"",$mount:"",$locale:"",$version:"",$path:"",$stop:!1,$redirect:{route:"",params:{}}},s=this.breakUrl(t),a=s.params;i.$locale=s.locale,i.$version=s.version,s.route?(i.$route=s.route.name,i.$handler=s.route.handler,i.$mount=s.route.mount,i.$path=s.route.path):i.$path=s.path,a&&(i=Object.assign(i,a));try{if(s.handler){if(s.locale&&l.host().locale(s.locale),s.version&&l.host().version(s.version),await s.handler(i),i.$redirect.route){let t=i.$redirect,e=i.$params;setTimeout(()=>{l.host().redirect(t,e)},0)}}else await e(i)}catch(t){l.host().raiseError(t)}})})})(),await(async()=>{const{Host:t}=await F("flair.app"),{ViewHandler:e,Page:s}=await F("flair.ui");c("sealed"),c("ns","flair.app"),i("ClientHost",t,function(){let t={},i=null;c("override"),this.construct=(t=>{t("Client"),this.currentLocale=this.defaultLocale}),this.app={get:()=>this.mounts["main"].app,set:G},this.mounts={get:()=>t,set:G},c("state"),c("private"),this.currentLocale="",this.defaultLocale={get:()=>Xt.i18n.lang.default,set:G},this.supportedLocales={get:()=>Xt.i18n.lang.locales.slice(),set:G},this.locale=((t,e)=>{if(t&&this.currentLocale!==t){let i=this.currentLocale;if(this.currentLocale=t,tt.props("api","locale".newLocale),e){let e=(!0).location.hash.replace(i,t);this.go(e)}}return this.currentLocale}),c("state"),c("private"),this.currentVersion="",this.version=((t,e)=>{if(t&&this.currentVersion!==t){let i=this.currentVersion;if(this.currentVersion=t,tt.props("api","version".newVersion),e){let e=(!0).location.hash.replace(i,t);this.go(e)}}return this.currentVersion}),this.routeToUrl=((t,e)=>{if(!t)return null;let i=l.context.current().getRoute(t),s;return i?this.mounts[i.mount].app.buildUrl(i.path,e):st(t,".","_")}),this.pathToUrl=((t,e)=>{let i;return this.urlToApp(t).buildUrl(t,e)}),c("private"),this.urlToApp=(t=>{"#!/"===t.substr(0,3)&&(t=t.substr(3)),"#!"===t.substr(0,2)&&(t=t.substr(2)),t.startsWith("/")||(t="/"+t);let e=null;for(let i in this.mounts)this.mounts.hasOwnProperty(i)&&t.startsWith(i.base)&&i.base.length>e.base.length&&(e=i);return e?e.app:this.app}),this.view={get:()=>e.currentView,set:G},this.redirect=(async(t,e,i)=>{await this.navigate(t,e,!0),i&&await this.refresh()}),this.navigate=(async(t,e,i)=>{e=e||{};let s=this.routeToUrl(t,e);s?await this.go(s,i):this.raiseError(q.NotFound(t,this.navigate))}),this.go=(async(t,e)=>{e?"#/"!==t&&history.replaceState(null,null,(!0).document.location.pathname+t):("#"===t.substr(0,1)&&(t=t.substr(1)),window.location.hash=t)}),this.refresh=(async()=>{setTimeout(()=>{i()},0)}),c("override"),this.boot=(async e=>{e();let i={},a=null,r="";const n=t=>{let e=this.getMountSpecificSettings("settings",Xt.routing,t,"name");if(e&&e.length>0)for(let t of e)i[t.name]=t.value;return i.base=Xt.routing.mounts[t],i};i=n("main");let o=(Xt.routing["main"]?Xt.routing["main"]["params"]:"")||"",l=new s(i,o);for(let e of Object.keys(Xt.routing.mounts))"main"===e?(a=l,r=o):(i=n(e),r=(Xt.routing[e]?Xt.routing[e]["params"]:"")||"",a=new s(i,r)),t[e]=Object.freeze({name:e,root:a.base,params:r,app:a});t=Object.freeze(t)}),c("override"),this.start=(async t=>{t(),i=(async()=>{let t=this.urlToApp((!0).location.hash);await t.run((!0).location.hash)})}),c("override"),this.ready=(async t=>{t(),(!0).addEventListener("hashchange",i),(!0).location.hash?await i():Xt.view.routes.home?await this.redirect(Xt.view.routes.home,{},!0):console.log(`No home route is configured.`),console.log(`${l.app().info.name}, v${l.app().info.version}`)}),c("override"),this.stop=(async t=>{t(),(!0).removeEventListener("hashchange",i)}),c("override"),this.dispose=(e=>{e(),t=null})})})(),await(async()=>{const{Bootware:t}=await F("flair.app"),{ViewHandler:e,ViewInterceptor:s}=await F("flair.ui");c("sealed"),c("ns","flair.boot"),i("ClientRouter",t,function(){let t=null;c("override"),this.construct=(t=>{t("Client Router",!0)}),c("override"),this.boot=(async(i,a)=>{i(),t||(t=l.context.current().allRoutes(!0)).sort((t,e)=>t.index<e.index?-1:t.index>e.index?1:0);const r=async t=>{let e=this.getMountSpecificSettings("interceptors",Xt.routing,a.name);for(let i of e){let e=y(await p(i),s);if(!e)throw q.InvalidDefinition(`Invalid interceptor type. (${i})`);if(await(new e).run(t),t.$stop)break}},n=async(t,i)=>{let s=null;t.endsWith("."+(Xt.view.static.fileExt||"xml"))&&(s=t,t=Xt.view.static.handler||"");let a=y(await p(t),e);if(!a)throw q.InvalidDefinition(`Invalid route handler. (${t})`);{let t=s?new a(s):new a;await t.view(i)}},o=t=>"string"==typeof t.handler?t.handler:t.handler[l.app().getRoutingContext(t.name)]||"**undefined**",c=t=>async e=>{if(await r(e),!e.$stop){let i=o(t);await n(i,e)}},h=(t,e)=>{t.add(e,c(e))};let u=a.app;for(let e of t)("string"==typeof e.mount&&e.mount===a.name||-1!==e.mount.indexOf(a.name))&&e.name!==Xt.view.routes.notfound&&h(u,e);u.add404(async t=>{let e=Xt.view.routes.notfound;if(e&&(e=l.context.current().getRoute(e)),!e)return alert(`404: ${t.$url} not found.`),void setTimeout(()=>{(!0).history.back()},0);await n(e.handler,t)})})})})(),await(async()=>{c("ns","flair.ui"),i("ViewInterceptor",function(){c("virtual"),c("async"),this.run=G})})(),await(async()=>{c("singleton"),c("ns","flair.ui"),i("ViewState",function(){c("state"),c("private"),this.store={},this.get=((t,e)=>(t=t||"",e=e||"",this.store[t+"/"+e]||null)),this.set=((t,e,i)=>{t=t||"",e=e||"","boolean"==typeof i||i?this.store[t+"/"+e]=i:delete this.store[t+"/"+e]}),this.clear=(()=>{this.store=null})})})(),l.context.current().currentAssemblyBeingLoaded(),l.registerAdo('{"name":"flair.client","file":"./flair.client{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.59.21","lupdate":"Sun, 08 Sep 2019 20:50:36 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.ui.ViewTransition","flair.ui.ViewHandler","flair.ui.Page","flair.app.ClientHost","flair.boot.ClientRouter","flair.ui.ViewInterceptor","flair.ui.ViewState"],"resources":[],"assets":[],"routes":[]}'),"function"==typeof onLoadComplete&&onLoadComplete(),Object.freeze({name:"flair.client",settings:Xt,config:Zt})});