/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.client
 *     File: ./flair.client.js
 *  Version: 0.55.95
 *  Sat, 31 Aug 2019 17:13:42 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(t,e){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>e):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e):t["flair.client"]=e}(this,async function(t,e){"use strict";const{Class:i,Struct:s,Enum:a,Interface:n,Mixin:r,Aspects:o,AppDomain:l,$$:h,attr:c,bring:u,Container:d,include:p,Port:f,on:m,post:g,telemetry:$,Reflector:w,Serializer:b,Tasks:y,as:v,is:V,isDefined:x,isComplies:T,isDerivedFrom:S,isAbstract:C,isSealed:L,isStatic:I,isSingleton:O,isDeprecated:E,isImplements:N,isInstanceOf:R,isMixed:A,getAssembly:W,getAttr:j,getContext:U,getResource:D,getRoute:k,getType:B,ns:M,getTypeOf:P,getTypeName:H,typeOf:z,dispose:F,using:_,Args:J,Exception:q,noop:G,nip:K,nim:Q,nie:X,event:Y}=t,{TaskInfo:Z}=t.Tasks,{env:tt}=t.options,{guid:et,stuff:it,replaceAll:st,splitAndTrim:at,findIndexByProp:nt,findItemByProp:rt,which:ot,isArrowFunc:lt,isASyncFunc:ht,sieve:ct,deepMerge:ut,getLoadedScript:dt,b64EncodeUnicode:pt,b64DecodeUnicode:ft,lens:mt,globalSetting:gt}=t.utils,{$$static:$t,$$abstract:wt,$$virtual:bt,$$override:yt,$$sealed:vt,$$private:Vt,$$privateSet:xt,$$protected:Tt,$$protectedSet:St,$$readonly:Ct,$$async:Lt,$$overload:It,$$enumerate:Ot,$$dispose:Et,$$post:Nt,$$on:Rt,$$timer:At,$$type:Wt,$$args:jt,$$inject:Ut,$$resource:Dt,$$asset:kt,$$singleton:Bt,$$serialize:Mt,$$deprecate:Pt,$$session:Ht,$$state:zt,$$conditional:Ft,$$noserialize:_t,$$ns:Jt}=h,qt=tt.isServer||tt.isWorker?null:(!0).document,Gt=l.context.current().name,Kt=e,Qt=Kt.substr(0,Kt.lastIndexOf("/")+1);l.loadPathOf("flair.client",Qt);let Xt=JSON.parse('{"view":{"el":"main","title":"","transition":""},"routes":{"home":"","notfound":""},"i18n":{"lang":{"default":"en","locales":[{"code":"en","name":"English","native":"English"}]}},"routing":{"mounts":{"main":"/"},"all":{"before":{"settings":[{"name":"hashbang","value":false},{"name":"lang","value":false},{"name":"sensitive","value":false}],"interceptors":[]},"after":{"settings":[],"interceptors":[]}}}}'),Yt=t.Port("settingsReader");if("function"==typeof Yt){let t=Yt("flair.client");t&&(Xt=ut([Xt,t],!1))}Xt=Object.freeze(Xt);let Zt=JSON.parse("{}");return Zt=Object.freeze(Zt),l.context.current().currentAssemblyBeingLoaded("./flair.client{.min}.js"),await(async()=>{h("ns","flair.ui"),i("ViewTransition",function(){h("virtual"),h("async"),this.enter=G,h("virtual"),h("async"),this.leave=G})})(),await(async()=>{const{Handler:t}=await M("flair.app","./flair.app.js"),{ViewTransition:e}=await M("flair.ui");h("ns","flair.ui"),i("ViewHandler",t,function(){let t="",i={};h("override"),this.construct=((e,i,s,a)=>{e(),i=i||Xt.view.el||"main",s=s||Xt.view.title||"",a=a||Xt.view.transition||"",t=i,this.viewTransition=a,this.title=this.title+(s?" - "+s:"")}),h("privateSet"),this.viewTransition="",h("protectedSet"),this.name="",h("protectedSet"),this.title="",h("protectedSet"),this.meta=null,h("protected"),h("virtual"),h("async"),this.beforeLoad=G,h("protected"),h("virtual"),h("async"),this.afterLoad=G,h("protected"),h("virtual"),h("async"),this.loadData=G,h("protected"),this.cancelLoadData=(async()=>{let t=null;for(let e in i)try{(t=i[e]).abort()}catch(t){}i={},await this.onCancelLoadData()}),h("protected"),this.abortHandle=(t=>{t=t||et();let e=new AbortController;return i[t]=e,e}),h("protected"),this.abort=(t=>{try{let e;i[t].abort()}catch(t){}}),h("protected"),h("virtual"),h("async"),this.onCancelLoadData=G,this.view=(async i=>{if(this.name=this.name||this.$Type.getName(!0),this.$static.loadingViewName=this.name,this.viewTransition){let t=v(await p(this.viewTransition),e);this.viewTransition=t?new t:""}let s=null,a=qt.getElementById(t);this.$static.currentViewName!==this.name?((s=qt.createElement("div")).id=this.name,s.setAttribute("hidden",""),a.appendChild(s)):s=qt.getElementById(this.name),await this.beforeLoad(i,s),await this.onView(i,s),await this.afterLoad(i,s),await this.swap(),this.loadData(i)}),h("protected"),h("virtual"),h("async"),this.onView=G,h("private"),this.swap=(async()=>{let e=qt.getElementById(this.name);if(this.$static.currentViewName){let i=qt.getElementById(this.$static.currentViewName);if(this.$static.currentViewCancelLoadData(),this.$static.currentViewName!==this.name){if(this.$static.currentViewMeta)for(let t of this.$static.currentViewMeta)qt.head.removeChild(qt.querySelector('meta[name="'+t+'"]'));this.$static.removeStyles(),this.viewTransition?(await this.viewTransition.leave(i,e),await this.viewTransition.enter(e,i)):(i&&(i.hidden=!0),e.hidden=!1);let s=qt.getElementById(t);i&&s.removeChild(i)}}if(this.$static.currentViewName!==this.name){if(this.meta)for(let t of this.meta){var i=document.createElement("meta");for(let e in t)i[e]=t[e];qt.head.appendChild(i)}!this.$static.currentViewName&&e&&(e.hidden=!1)}qt.title=this.title,this.$static.currentViewName=this.name,this.$static.loadingViewName=null,this.$static.currentViewMeta=this.meta,this.$static.currentViewCancelLoadData=this.cancelLoadData}),h("static"),this.currentViewName=null,h("static"),this.currentViewMeta=null,h("static"),this.currentViewCancelLoadData=null,h("static"),this.loadingViewName=null,h("static"),this.removeStyles=function(){if(this.currentViewName){let t=document.head.getElementsByTagName("style"),e=this.currentViewName;for(let i of t)i.id&&i.id.startsWith(`_${e}_style_`)&&document.head.removeChild(i)}},h("static"),this.addStyle=function(t,e){if(this.loadingViewName){let i=(!0).document.createElement("style");i.id=`_${this.loadingViewName}_style_${t}`,i.type="text/css",i.appendChild((!0).document.createTextNode(e)),(!0).document.head.appendChild(i)}}})})(),await(async()=>{h("sealed"),h("ns","flair.ui"),i("Page",function(){let t=[],e;this.construct=(t=>{this.hasbang=t.hasbang||!1,this.lang=t.lang||!1,this.base=t.base||"",this.sensitive=t.sensitive||!1,this.base.endsWith("/")&&(this.base=this.base.substr(0,this.base.length-1)),this.base.startsWith("/")||(this.base="/"+this.base)}),h("readonly"),this.hasbang=!1,h("readonly"),this.lang=!1,h("readonly"),this.base="",h("readonly"),this.sensitive=!1,h("private"),this.pathToRegExp=((t,e)=>{t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1));let i=t?t.split("/"):[],s="",a=0;for(let t of i)(t=t.trim()).startsWith(":")?(e.push({name:t.substr(1),index:a}),s+="/.[^/]*"):s+="/"+t,a++;s+="/";let n=null;return n=this.sensitive?new RegExp(s):new RegExp(s,"i")}),this.breakUrl=(e=>{let i={url:e,path:"",loc:"",params:{},handler:null,route:null},s=e;if("/"===s.substr(0,1)&&(s=s.substr(1)),"#!/"===s.substr(0,3)&&(s=s.substr(3)),"#!"===s.substr(0,2)&&(s=s.substr(2)),"#/"===s.substr(0,2)&&(s=s.substr(2)),"#"===s.substr(0,1)&&(s=s.substr(1)),"/"===s.substr(0,1)&&(s=s.substr(1)),(s="/"+s).startsWith(this.base)&&(s=s.substr(this.base.length)),this.lang){s.startsWith("/")&&(s=s.substr(1));let t=s.split("/");if(t.length>0){let e=t[0].trim();-1!==l.host().supportedLocales.indexOf(e)&&(i.loc=e),t.shift(),(s=t.join("/")).startsWith("/")||(s="/"+s)}}s.startsWith("/")||(s="/"+s);let a=s.indexOf("?"),n="",r=null;if(-1!==a){n=s.substr(a+1),s=s.substr(0,a);let t=n.split("&"),e=null;for(let i of t)e=i.split("="),(r=r||{})[e[0].trim()]=decodeURIComponent(e[1].trim())}s.endsWith("/")||(s+="/"),i.path=s;for(let e of t){let t=e.regex.exec(decodeURIComponent(s));if(t&&t.input===t[0]){s.startsWith("/")&&(s=s.substr(1)),s.endsWith("/")&&(s=s.substr(0,s.length-1));let t=s?s.split("/"):[];for(let s of e.keys)i.params[s.name]=t[s.index];i.handler=e.handler,i.route=e.route;break}}return r&&(i.params=Object.assign(i.params,r)),i}),this.buildUrl=((t,e)=>{let i=this.base;if(i.endsWith("/")||(i+="/"),this.lang&&(i+=l.host().currentLocale+"/"),t.startsWith("/")&&(t=t.substr(1)),(i+=t).startsWith("/")||(i="/"+i),(i=this.hasbang?"#!"+i:"#"+i).endsWith("/")||(i+="/"),e){let t=-1,s="?",a=null;for(let n in e)e.hasOwnProperty(n)&&(t=i.indexOf(`:${n}`),a=encodeURIComponent(e[n].toString()),-1!==t?i=st(i,`:${n}`,a):s+=`${n}=${a}`);"?"!==s&&(i+=s)}return i}),this.rebuildUrl=(t=>{let e=this.breakUrl(t);return this.buildUrl(e.path,e.params)}),this.add=((e,i)=>{let s=[];t.push({route:e,path:e.path,keys:s,regex:this.pathToRegExp(e.path,s),handler:i})}),this.add404=(t=>{e=t}),this.run=(async t=>{let i={$url:t,$page:"",$route:"",$handler:"",$mount:"",$path:"",$stop:!1,$redirect:{route:"",params:{}}},s=this.breakUrl(t),a=s.loc,n=s.params;s.route?(i.$route=s.route.name,i.$handler=s.route.handler,i.$mount=s.route.mount,i.$path=s.route.path):i.$path=s.path,n&&(i=Object.assign(i,n));try{if(s.handler){if(this.lang&&l.host().locale(a),await s.handler(i),i.$redirect.route){let t=i.$redirect,e=i.$params;setTimeout(()=>{l.host().redirect(t,e)},0)}}else await e(i)}catch(t){l.host().raiseError(t)}})})})(),await(async()=>{const{Host:t,RouteSettingReader:e}=await M("flair.app","./flair.app.js"),{ViewHandler:s,Page:a}=await M("flair.ui");h("sealed"),h("ns","flair.app"),i("ClientHost",t,function(){let t={},i=null;h("override"),this.construct=(t=>{t("Client")}),this.app={get:()=>this.mounts["main"].app,set:G},this.mounts={get:()=>t,set:G},h("state"),h("private"),this.currentLocale=Xt.i18n.lang.default,this.defaultLocale={get:()=>Xt.i18n.lang.default,set:G},this.supportedLocales={get:()=>Xt.i18n.lang.locales.slice(),set:G},this.locale=((t,e)=>{if(t&&this.currentLocale!==t&&(this.currentLocale=t,e)){let t,e=this((!0).location.hash).rebuildUrl((!0).location.hash);this.go(e)}return this.currentLocale}),this.routeToUrl=((t,e)=>{if(!t)return null;let i=l.context.current().getRoute(t),s;return i?this.mounts[i.mount].app.buildUrl(i.path,e):st(t,".","_")}),this.pathToUrl=((t,e)=>{let i;return this.urlToApp(t).buildUrl(t,e)}),h("private"),this.urlToApp=(t=>{"#!/"===t.substr(0,3)&&(t=t.substr(3)),"#!"===t.substr(0,2)&&(t=t.substr(2)),t.startsWith("/")||(t="/"+t);let e=null;for(let i in this.mounts)this.mounts.hasOwnProperty(i)&&t.startsWith(i.base)&&i.base.length>e.base.length&&(e=i);return e?e.app:this.app}),this.view={get:()=>s.currentView,set:G},this.redirect=(async(t,e,i)=>{await this.navigate(t,e,!0),i&&await this.refresh()}),this.navigate=(async(t,e,i)=>{e=e||{};let s=this.routeToUrl(t,e);s?await this.go(s,i):this.raiseError(q.NotFound(t,this.navigate))}),this.go=(async(t,e)=>{e?history.replaceState(null,null,(!0).document.location.pathname+t):("#"===t.substr(0,1)&&(t=t.substr(1)),window.location.hash=t)}),this.refresh=(async()=>{setTimeout(()=>{i()},0)}),h("override"),this.boot=(async i=>{i();let s={},n=null;const r=t=>{let i=e.getMergedSection("settings",Xt.routing,t,"name");if(i&&i.length>0)for(let t of i)s[t.name]=t.value;return s.base=Xt.routing.mounts[t],s};s=r("main");let o=new a(s);for(let e of Object.keys(Xt.routing.mounts))"main"===e?n=o:(s=r(e),n=new a(s)),t[e]=Object.freeze({name:e,root:n.base,app:n});t=Object.freeze(t)}),h("override"),this.start=(async t=>{t(),i=(async()=>{let t=this.urlToApp((!0).location.hash);await t.run((!0).location.hash)})}),h("override"),this.ready=(async t=>{t(),(!0).addEventListener("hashchange",i),Xt.routes.home&&await this.redirect(Xt.routes.home,{},!0),console.log(`${l.app().info.name}, v${l.app().info.version}`)}),h("override"),this.stop=(async t=>{t(),(!0).removeEventListener("hashchange",i)}),h("override"),this.dispose=(e=>{e(),t=null})})})(),await(async()=>{const{Bootware:t,RouteSettingReader:e}=await M("flair.app","./flair.app.js"),{ViewHandler:s,ViewInterceptor:a}=await M("flair.ui");h("sealed"),h("ns","flair.boot"),i("ClientRouter",t,function(){let t=null;h("override"),this.construct=(t=>{t("Client Router",!0)}),h("override"),this.boot=(async(i,n)=>{i(),t||(t=l.context.current().allRoutes(!0)).sort((t,e)=>t.index<e.index?-1:t.index>e.index?1:0);const r=async(t,e)=>{let i=v(await p(t),s);if(!i)throw q.InvalidDefinition(`Invalid route handler. (${t})`);{let t=new i;await t.view(e)}},o=t=>"string"==typeof t.handler?t.handler:t.handler[l.app().getRoutingContext(t.name)]||"**undefined**",h=function(t){return async i=>{let s=e.getMergedSection("interceptors",Xt.routing,n.name);for(let t of s){let e=v(await p(t),a);if(!e)throw q.InvalidDefinition(`Invalid interceptor type. (${t})`);if(await(new e).run(i),i.$stop)break}if(!i.$stop){let e=o(t);await r(e,i)}}};let c=n.app;for(let e of t)("string"==typeof e.mount&&e.mount===n.name||-1!==e.mount.indexOf(n.name))&&e.name!==Xt.routes.notfound&&c.add(e,h(e));c.add404(async t=>{let e=Xt.routes.notfound;e&&(e=l.context.current().getRoute(e)),e?await r(e.handler,t):setTimeout(()=>{(!0).history.back()},0)})})})})(),await(async()=>{h("ns","flair.ui"),i("ViewInterceptor",function(){h("virtual"),h("async"),this.run=G})})(),await(async()=>{h("singleton"),h("ns","flair.ui"),i("ViewState",function(){h("state"),h("private"),this.store={},this.get=((t,e)=>(t=t||"",e=e||"",this.store[t+"/"+e]||null)),this.set=((t,e,i)=>{t=t||"",e=e||"","boolean"==typeof i||i?this.store[t+"/"+e]=i:delete this.store[t+"/"+e]}),this.clear=(()=>{this.store=null})})})(),l.context.current().currentAssemblyBeingLoaded(),l.registerAdo('{"name":"flair.client","file":"./flair.client{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.55.95","lupdate":"Sat, 31 Aug 2019 17:13:42 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.ui.ViewTransition","flair.ui.ViewHandler","flair.ui.Page","flair.app.ClientHost","flair.boot.ClientRouter","flair.ui.ViewInterceptor","flair.ui.ViewState"],"resources":[],"assets":[],"routes":[]}'),"function"==typeof onLoadComplete&&onLoadComplete(),Object.freeze({name:"flair.client",settings:Xt,config:Zt})});