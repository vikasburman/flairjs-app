/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.60.9
 *  Tue, 24 Sep 2019 16:45:51 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(e,t){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>t):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),module.exports=exports=t):e["flair.app"]=t}(this,async function(e,t){"use strict";const{Class:a,Struct:i,Enum:s,Interface:r,Mixin:n,Aspects:o,AppDomain:l,$$:c,attr:p,bring:f,Container:u,include:d,Port:h,on:y,post:w,telemetry:m,Reflector:b,Serializer:v,Tasks:g,as:x,is:S,isDefined:k,isComplies:C,isDerivedFrom:E,isAbstract:A,isSealed:O,isStatic:H,isSingleton:I,isDeprecated:j,isImplements:D,isInstanceOf:P,isMixed:B,getAssembly:M,getAttr:R,getContext:T,getResource:N,getRoute:W,getType:F,ns:V,getTypeOf:z,getTypeName:$,typeOf:L,dispose:J,using:U,Args:_,Exception:G,noop:K,nip:q,nim:Q,nie:X,event:Y}=e,{TaskInfo:Z}=e.Tasks,{env:ee}=e.options,{guid:te,stuff:ae,replaceAll:ie,splitAndTrim:se,findIndexByProp:re,findItemByProp:ne,which:oe,isArrowFunc:le,isASyncFunc:ce,sieve:pe,deepMerge:fe,getLoadedScript:ue,b64EncodeUnicode:de,b64DecodeUnicode:he,lens:ye,globalSetting:we}=e.utils,me=ee.isServer||ee.isWorker?null:(!0).document,be=l.context.current().name,ve=t,ge=ve.substr(0,ve.lastIndexOf("/")+1);l.loadPathOf("flair.app",ge);let xe=JSON.parse('{"host":"flair.app.ServerHost | flair.app.ClientHost","app":"flair.app.App","boot":{"env":{"isVue":false,"isExpress":false,"isServerless":false,"isFirebase":false},"links":[],"scripts":[],"meta":[],"preambles":[],"ports":[],"bootwares":[],"assemblies":[]},"di":{"container":{}},"api":{"connections":{}}}'),Se=h("settingsReader");if("function"==typeof Se){let e=Se("flair.app");e&&(xe=fe([xe,e],!1))}xe=Object.freeze(xe);let ke=JSON.parse("{}");ke=Object.freeze(ke);const Ce=e=>{const t=(t,a)=>{let i=e.getType(a);i&&u.register(t,i)};t("cache","flair.app.attr.Cache")};return l.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),await(async()=>{c("abstract"),c("ns","flair.app"),a("Bootware",function(){c("virtual"),this.construct=((e,t,a)=>{let i=_("name: string, version: string","name: string, version: string, isMountSpecific: boolean","name: string, isMountSpecific: boolean","name: string")(e,t,a);i.throwOnError(this.construct),this.info=Object.freeze({name:i.values.name||"",version:i.values.version||"",isMountSpecific:i.values.isMountSpecific||!1})}),c("virtual"),c("async"),this.boot=K,c("readonly"),this.info=null,c("virtual"),c("async"),this.ready=K,c("virtual"),this.dispose=K,c("protected"),this.getMountSpecificSettings=((e,t,a,i)=>{let s=[];if(t.all&&t.all.before&&t.all.before[e]&&s.push(...t.all.before[e]),t[a]&&t[a][e])if(0===s.length)s.push(...t[a][e]);else if(i)for(let r of t[a][e]){let e=ne(s,i,r[i]);if(null!==e)for(let t in r)e[t]=r[t];else s.push(r)}else for(let i of t[a][e])"string"==typeof i&&-1!==s.indexOf(i)||s.push(i);if(t.all&&t.all.after&&t.all.after[e])if(0===s.length)s.push(...t.all.after[e]);else if(i)for(let a of t.all.after[e]){let e;null!==ne(s,i,a[i])||s.push(a)}else for(let a of t.all.after[e])"string"==typeof a&&-1!==s.indexOf(a)||s.push(a);return s})})})(),await(async()=>{c("ns","flair.app"),a("HandlerContext",function(){c("virtual"),this.construct=(()=>{}),c("private"),this.items={},this.getData=((e,t)=>this.items[e]||t),this.setData=((e,t)=>{this.items[e]=t})})})(),await(async()=>{c("ns","flair.app"),a("Payload",function(){c("virtual"),this.construct=((e,t,a,i)=>{this.data=e||null,this.status=t||null,Array.isArray(i)&&this.resHeaders.push(...i),a&&this.resHeaders.push({name:"Content-Type",value:a||"text/plain"})}),c("readonly"),this.data=null,c("readonly"),this.status=null,c("readonly"),this.resHeaders=[]})})(),await(async()=>{const{IDisposable:e}=await V();c("ns","flair.app"),a("Handler",[e],function(){c("virtual"),this.construct=(e=>{this.route=l.context.current().getRoute(e.name)}),c("protected"),this.route=null,c("virtual"),c("async"),this.run=K,c("virtual"),this.dispose=K})})(),await(async()=>{const{IDisposable:e}=await V(),{Bootware:t}=await V("flair.app");c("ns","flair.app"),a("App",t,[e],function(){c("override"),this.construct=(e=>{let t=M(this);e(t.title,t.version)}),c("override"),c("sealed"),this.boot=(async e=>{e(),l.host().error.add(this.handleError)}),this.start=(async()=>{if(!ee.isServer&&!ee.isWorker){const{ViewState:e}=await V("flair.ui");new e}await this.onStart()}),c("virtual"),c("async"),this.onStart=K,c("override"),c("sealed"),this.ready=(async()=>{await this.onReady()}),c("virtual"),c("async"),this.onReady=K,this.stop=(async()=>{if(!ee.isServer&&!ee.isWorker){const{ViewState:e}=await V("flair.ui");(new e).clear()}await this.onStop()}),c("virtual"),c("async"),this.onStop=K,c("private"),this.handleError=(e=>{this.onError(e.args.error)}),c("virtual"),this.onError=(e=>{throw G.OperationFailed(e,this.onError)}),c("virtual"),this.getRoutingContext=K,c("override"),this.dispose=(e=>{e(),l.host().error.remove(this.handleError)})})})(),await(async()=>{const{Payload:e}=await V("flair.app");c("ns","flair.app"),a("HandlerResult",function(){c("virtual"),this.construct=((t,a,i)=>{let s=200,r="OK",n="Exception";if(a&&S(a,e)&&(s=a.status||s,this.isExtendedPayload=!0),t&&t.name)switch(r=t.name||(ee.isServer?"InternalServerError":"InternalClientError"),t.name){case"Continue"+n:s=100;break;case"NoContent"+n:s=204;break;case"Redirect"+n:s=302;break;case"NotModified"+n:s=304;break;case"InvalidArgument"+n:case"InvalidOperation"+n:s=406;break;case"Unauthorized"+n:s=401;break;case"NotFound"+n:s=404;break;case"NotAllowed"+n:case"NotAvailable"+n:case"NotSupported"+n:s=405;break;case"OperationConflict"+n:case"Duplicate"+n:s=409;break;case"NotImplemented"+n:case"NotDefined"+n:s=501;break;default:s=500;break}this.status=s,this.message=r,this.isError=!!t,t&&ee.isDebug&&(this.message+=`\n${t.message||""}`,this.message+=`\n${t.stack||""}`),this.data=a||null,Array.isArray(i)&&this.resHeaders.push(...i)}),c("private"),this.isExtendedPayload=!1,c("readonly"),this.status=500,c("readonly"),this.message="",c("readonly"),this.isError=!1,c("readonly"),this.data=null,c("readonly"),this.resHeaders=[],this.value=(()=>Object.freeze({isError:this.isError,status:this.status,message:this.message,data:this.isExtendedPayload?this.data.data:this.data}))})})(),await(async()=>{const{IDisposable:e}=await V(),{Bootware:t}=await V("flair.app");c("ns","flair.app"),a("Host",t,[e],function(){c("virtual"),c("async"),this.start=K,c("virtual"),c("async"),this.stop=K,this.error=Y(e=>({error:e})),this.raiseError=(e=>{this.error(e)})})})(),await(async()=>{const{Bootware:t,IPortHandler:i}=await V("flair.app");c("static"),c("ns","flair.app"),a("BootEngine",function(){this.start=async function(){let a=[],s=[];const r=async()=>{ee.x(xe.boot.env)},n=(e,t)=>{let a=null,i=null,s=!1,r=!1,n=(!0).document.getElementsByTagName("head")[0];for(let o of e){a=document.createElement(t),s=!1,r=!1;for(let e in o)o.hasOwnProperty(e)&&(i=o[e],-1!==["src","href"].indexOf(e)&&((i=oe(i))||(r=!0)),s=!0,a.setAttribute(e,i));s&&!r&&n.appendChild(a)}},o=async()=>{if(ee.isClient&&!ee.isWorker){let e=[];e.push(...xe.boot.scripts),n(e,"script")}},c=async()=>{if(ee.isClient&&!ee.isWorker){let e=[];e.push(...xe.boot.links),n(e,"link")}},p=async()=>{if(ee.isClient&&!ee.isWorker){let t=[{name:"BuiltWith",content:`${e.info.name}`}];t.push(...xe.boot.meta),n(t,"meta")}},f=async()=>{let t=null,a=null;(t=[]).push(...xe.boot.preambles);for(let i of t)(i=oe(i))&&(i.endsWith("/")||(i+="/"),i+="preamble{.min}.js",a=await d(i),await a(e))},u=async()=>{let e=["./flair.app{.min}.js","./flair.server{.min}.js | ./flair.client{.min}.js","isExpress::./flair.server.express{.min}.js | isVue::./flair.client.vue{.min}.js","isFirebase::./flair.server.firebase{.min}.js | x"];e.push(...xe.boot.assemblies);for(let t of e)(t=oe(t))&&await l.context.loadAssembly(t)},y=async()=>{let e=null,t=null,a=null;(e=[]).push(...xe.boot.ports);for(let s of e)(s=oe(s))&&(t=await d(t),(a=x(new t,i))&&h.connect(a.port,a.factory))},w=async()=>{let e=null,i=null,r=null;(e=["flair.boot.NodeEnv ~ x | x","isExpress::flair.boot.Middlewares ~ x | x","flair.boot.ResHeaders ~ x | x","flair.boot.DIContainer","x | isVue::flair.boot.VueSetup ~ x","flair.boot.ServerRouter ~ x | flair.boot.ClientRouter | x"]).push(...xe.boot.bootwares);for(let n of e)(n=oe(n))&&(i=x(await d(n),t))&&(r=new i,a.push(r),r.info.isMountSpecific&&s.push(r))},m=async e=>{if(ee.isWorker){0!==s.length&&console.warn("Mount specific bootwares are not supported for worker environment. Revisit worker:flair.app->load setting.");for(let t of a)t.info.isMountSpecific||await t[e]()}else{let t=l.host().mounts,i=Object.keys(t),r="",n=null;n=t[r="main"];for(let t of a)await t[e](n);for(let a of i)if("main"!==a){n=t[a];for(let t of s)await t[e](n)}}},b=async()=>{const e=await d(xe.host),t=await d(xe.app);if(!ee.isWorker){let t=new e;await t.boot(),l.host(t)}await m("boot");let a=new t;await a.boot(),l.app(a)},v=async()=>{ee.isWorker||await l.host().start(),await l.app().start()},g=()=>new Promise((e,t)=>{"loading"!==document.readyState?e():(!0).document.addEventListener("DOMContentLoaded",()=>{e()})}),S=()=>new Promise((e,t)=>{(!0).document.addEventListener("deviceready",()=>{e()},!1)}),k=async()=>{ee.isClient&&!ee.isWorker&&(await g(),ee.isCordova&&await S()),ee.isWorker||await l.host().ready(),await m("ready"),await l.app().ready()};return await r(),await p(),await c(),await o(),await f(),await u(),await y(),await w(),await b(),await v(),await k(),console.log("ready!"),!0}})})(),await(async()=>{c("ns","flair.app"),r("IPortHandler",function(){this.port=q,this.factory=Q})})(),await(async()=>{const{Attribute:e}=await V();c("ns","flair.app.attr"),a("Cache",e,function(){c("override"),this.construct=((e,t)=>{e(t),this.cacheConfig="number"==typeof t?{duration:t}:t,this.enabled=this.cacheConfig&&this.cacheConfig.duration,this.cacheHandler=h("cacheHandler"),this.constraints="(class || struct) && (func && async) && !(timer || on || @fetch || @cache)"}),c("readonly"),this.cacheConfig=null,c("private"),this.cacheHandler=null,c("private"),this.enabled=!1,c("override"),this.decorateFunction=((e,t,a,i)=>{let s=this,r=`${t}___${a}`,n=async(...e)=>{let t=await i(...e);return s.enabled&&await s.cacheHandler.set(r,s.cacheConfig,t),t};return async function(...e){if(s.enabled)try{return await s.cacheHandler.get(r,s.cacheConfig)}catch(e){}return await n(...e)}})})})(),await(async()=>{const{Bootware:e}=await V("flair.app");c("sealed"),c("ns","flair.boot"),a("DIContainer",e,function(){c("override"),this.construct=(e=>{e("DI Container")}),c("override"),this.boot=(async e=>{e();let t=xe.di.container;for(let e in t)t.hasOwnProperty(e)&&u.register(e,t[e])})})})(),l.context.current().currentAssemblyBeingLoaded("","function"==typeof Ce?Ce:null),l.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.60.9","lupdate":"Tue, 24 Sep 2019 16:45:51 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.app.Bootware","flair.app.HandlerContext","flair.app.Payload","flair.app.Handler","flair.app.App","flair.app.HandlerResult","flair.app.Host","flair.app.BootEngine","flair.app.IPortHandler","flair.app.attr.Cache","flair.boot.DIContainer"],"resources":[],"assets":[],"routes":[]}'),Object.freeze({name:"flair.app",settings:xe,config:ke})});