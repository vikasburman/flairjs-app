/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.60.18
 *  Wed, 25 Sep 2019 00:20:53 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(t,e){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>e):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e):t["flair.app"]=e}(this,async function(t,e){"use strict";const{Class:a,Struct:i,Enum:r,Interface:s,Mixin:n,Aspects:o,AppDomain:l,$$:c,attr:f,bring:p,Container:h,include:u,Port:d,on:y,post:m,telemetry:w,Reflector:g,Serializer:b,Tasks:v,as:x,is:I,isDefined:C,isComplies:A,isDerivedFrom:S,isAbstract:k,isSealed:O,isStatic:F,isSingleton:H,isDeprecated:E,isImplements:j,isInstanceOf:$,isMixed:P,getAssembly:D,getAttr:R,getContext:B,getResource:W,getRoute:M,getType:N,ns:T,getTypeOf:_,getTypeName:V,typeOf:q,dispose:z,using:L,Args:U,Exception:J,noop:G,nip:K,nim:Q,nie:X,event:Y}=t,{TaskInfo:Z}=t.Tasks,{env:tt}=t.options,{guid:et,stuff:at,replaceAll:it,splitAndTrim:rt,findIndexByProp:st,findItemByProp:nt,which:ot,isArrowFunc:lt,isASyncFunc:ct,sieve:ft,deepMerge:pt,getLoadedScript:ht,b64EncodeUnicode:ut,b64DecodeUnicode:dt,lens:yt,globalSetting:mt}=t.utils,wt=tt.isServer||tt.isWorker?null:(!0).document,gt=l.context.current().name,bt=e,vt=bt.substr(0,bt.lastIndexOf("/")+1);l.loadPathOf("flair.app",vt);let xt=JSON.parse('{"host":"flair.app.ServerHost | flair.app.ClientHost","app":"flair.app.App","boot":{"env":{"isVue":false,"isExpress":false,"isServerless":false,"isFirebase":false},"links":[],"scripts":[],"meta":[],"preambles":[],"ports":[],"bootwares":[],"assemblies":[],"attributes":[]},"di":{"container":{}},"api":{"connections":{}}}'),It=d("settingsReader");if("function"==typeof It){let t=It("flair.app");t&&(xt=pt([xt,t],!1))}xt=Object.freeze(xt);let Ct=JSON.parse("{}");Ct=Object.freeze(Ct);const At=t=>{};return l.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),await(async()=>{c("abstract"),c("ns","flair.app"),a("Bootware",function(){c("virtual"),this.construct=((t,e,a)=>{let i=U("name: string, version: string","name: string, version: string, isMountSpecific: boolean","name: string, isMountSpecific: boolean","name: string")(t,e,a);i.throwOnError(this.construct),this.info=Object.freeze({name:i.values.name||"",version:i.values.version||"",isMountSpecific:i.values.isMountSpecific||!1})}),c("virtual"),c("async"),this.boot=G,c("readonly"),this.info=null,c("virtual"),c("async"),this.ready=G,c("virtual"),this.dispose=G,c("protected"),this.getMountSpecificSettings=((t,e,a,i)=>{let r=[];if(e.all&&e.all.before&&e.all.before[t]&&r.push(...e.all.before[t]),e[a]&&e[a][t])if(0===r.length)r.push(...e[a][t]);else if(i)for(let s of e[a][t]){let t=nt(r,i,s[i]);if(null!==t)for(let e in s)t[e]=s[e];else r.push(s)}else for(let i of e[a][t])"string"==typeof i&&-1!==r.indexOf(i)||r.push(i);if(e.all&&e.all.after&&e.all.after[t])if(0===r.length)r.push(...e.all.after[t]);else if(i)for(let a of e.all.after[t]){let t;null!==nt(r,i,a[i])||r.push(a)}else for(let a of e.all.after[t])"string"==typeof a&&-1!==r.indexOf(a)||r.push(a);return r})})})(),await(async()=>{c("ns","flair.app"),a("HandlerContext",function(){c("virtual"),this.construct=(()=>{}),c("private"),this.items={},this.getData=((t,e)=>this.items[t]||e),this.setData=((t,e)=>{this.items[t]=e})})})(),await(async()=>{c("ns","flair.app"),a("Payload",function(){c("virtual"),this.construct=((t,e,a,i)=>{this.data=t||null,this.status=e||null,Array.isArray(i)&&this.resHeaders.push(...i),a&&this.resHeaders.push({name:"Content-Type",value:a||"text/plain"})}),c("readonly"),this.data=null,c("readonly"),this.status=null,c("readonly"),this.resHeaders=[]})})(),await(async()=>{const{IDisposable:t}=await T();c("ns","flair.app"),a("Handler",[t],function(){c("virtual"),this.construct=(t=>{this.route=l.context.current().getRoute(t.name)}),c("protected"),this.route=null,c("virtual"),c("async"),this.run=G,c("virtual"),this.dispose=G})})(),await(async()=>{const{IDisposable:t}=await T(),{Bootware:e}=await T("flair.app");c("ns","flair.app"),a("App",e,[t],function(){c("override"),this.construct=(t=>{let e=D(this);t(e.title,e.version)}),c("override"),c("sealed"),this.boot=(async t=>{t(),l.host().error.add(this.handleError)}),this.start=(async()=>{if(!tt.isServer&&!tt.isWorker){const{ViewState:t}=await T("flair.ui");new t}await this.onStart()}),c("virtual"),c("async"),this.onStart=G,c("override"),c("sealed"),this.ready=(async()=>{await this.onReady()}),c("virtual"),c("async"),this.onReady=G,this.stop=(async()=>{if(!tt.isServer&&!tt.isWorker){const{ViewState:t}=await T("flair.ui");(new t).clear()}await this.onStop()}),c("virtual"),c("async"),this.onStop=G,c("private"),this.handleError=(t=>{this.onError(t.args.error)}),c("virtual"),this.onError=(t=>{throw J.OperationFailed(t,this.onError)}),c("virtual"),this.getRoutingContext=G,c("override"),this.dispose=(t=>{t(),l.host().error.remove(this.handleError)})})})(),await(async()=>{const{Payload:t}=await T("flair.app");c("ns","flair.app"),a("HandlerResult",function(){c("virtual"),this.construct=((e,a,i)=>{let r=200,s="OK",n="Exception";if(a&&I(a,t)&&(r=a.status||r,this.isExtendedPayload=!0),e&&e.name)switch(s=e.name||(tt.isServer?"InternalServerError":"InternalClientError"),e.name){case"Continue"+n:r=100;break;case"NoContent"+n:r=204;break;case"Redirect"+n:r=302;break;case"NotModified"+n:r=304;break;case"InvalidArgument"+n:case"InvalidOperation"+n:r=406;break;case"Unauthorized"+n:r=401;break;case"NotFound"+n:r=404;break;case"NotAllowed"+n:case"NotAvailable"+n:case"NotSupported"+n:r=405;break;case"OperationConflict"+n:case"Duplicate"+n:r=409;break;case"NotImplemented"+n:case"NotDefined"+n:r=501;break;default:r=500;break}this.status=r,this.message=s,this.isError=!!e,e&&tt.isDebug&&(this.message+=`\n${e.message||""}`,this.message+=`\n${e.stack||""}`),this.data=a||null,Array.isArray(i)&&this.resHeaders.push(...i)}),c("private"),this.isExtendedPayload=!1,c("readonly"),this.status=500,c("readonly"),this.message="",c("readonly"),this.isError=!1,c("readonly"),this.data=null,c("readonly"),this.resHeaders=[],this.value=(()=>Object.freeze({isError:this.isError,status:this.status,message:this.message,data:this.isExtendedPayload?this.data.data:this.data}))})})(),await(async()=>{const{IDisposable:t}=await T(),{Bootware:e}=await T("flair.app");c("ns","flair.app"),a("Host",e,[t],function(){c("virtual"),c("async"),this.start=G,c("virtual"),c("async"),this.stop=G,this.error=Y(t=>({error:t})),this.raiseError=(t=>{this.error(t)})})})(),await(async()=>{const{Bootware:e,IPortHandler:i}=await T("flair.app"),{Attribute:r}=await T();c("static"),c("ns","flair.app"),a("BootEngine",function(){this.start=async function(){let a=[],s=[];const n=async()=>{tt.x(xt.boot.env)},o=(t,e)=>{let a=null,i=null,r=!1,s=!1,n=(!0).document.getElementsByTagName("head")[0];for(let o of t){a=document.createElement(e),r=!1,s=!1;for(let t in o)o.hasOwnProperty(t)&&(i=o[t],-1!==["src","href"].indexOf(t)&&((i=ot(i))||(s=!0)),r=!0,a.setAttribute(t,i));r&&!s&&n.appendChild(a)}},c=async()=>{if(tt.isClient&&!tt.isWorker){let t=[];t.push(...xt.boot.scripts),o(t,"script")}},f=async()=>{if(tt.isClient&&!tt.isWorker){let t=[];t.push(...xt.boot.links),o(t,"link")}},p=async()=>{if(tt.isClient&&!tt.isWorker){let e=[{name:"BuiltWith",content:`${t.info.name}`}];e.push(...xt.boot.meta),o(e,"meta")}},y=async()=>{let e=null,a=null;(e=[]).push(...xt.boot.preambles);for(let i of e)(i=ot(i))&&(i.endsWith("/")||(i+="/"),i+="preamble{.min}.js",a=await u(i),await a(t))},m=async()=>{let t=["./flair.app{.min}.js","./flair.server{.min}.js | ./flair.client{.min}.js","isExpress::./flair.server.express{.min}.js | isVue::./flair.client.vue{.min}.js","isFirebase::./flair.server.firebase{.min}.js | x"];t.push(...xt.boot.assemblies);for(let e of t)(e=ot(e))&&await l.context.loadAssembly(e)},w=async()=>{let t=null,e=null,a=null;(t=["flair.app.ajax.FetchPort","flair.app.caching.CachePort"]).push(...xt.boot.ports);for(let r of t)(r=ot(r))&&(e=await u(r),(a=x(new e,i))&&d.connect(a.port,a.factory))},g=async()=>{let t=null,e=null;(t=[{name:"fetch",type:"flair.app.ajax.FetchAttr"},{name:"cache",type:"flair.app.caching.CacheAttr"}]).push(...xt.boot.attributes);for(let a of t)a.type=ot(a.type),a.name&&a.type&&!h.isRegistered(a.name)&&(e=x(await u(a.type),r))&&h.register(a.name,e)},b=async()=>{let t=null,i=null,r=null;(t=["flair.boot.NodeEnv ~ x | x","isExpress::flair.boot.Middlewares ~ x | x","flair.boot.ResHeaders ~ x | x","flair.boot.DIContainer","x | isVue::flair.boot.VueSetup ~ x","flair.boot.ServerRouter ~ x | flair.boot.ClientRouter | x"]).push(...xt.boot.bootwares);for(let n of t)(n=ot(n))&&(i=x(await u(n),e))&&(r=new i,a.push(r),r.info.isMountSpecific&&s.push(r))},v=async t=>{if(tt.isWorker){0!==s.length&&console.warn("Mount specific bootwares are not supported for worker environment. Revisit worker:flair.app->load setting.");for(let e of a)e.info.isMountSpecific||await e[t]()}else{let e=l.host().mounts,i=Object.keys(e),r="",n=null;n=e[r="main"];for(let e of a)await e[t](n);for(let a of i)if("main"!==a){n=e[a];for(let e of s)await e[t](n)}}},I=async()=>{const t=await u(xt.host),e=await u(xt.app);if(!tt.isWorker){let e=new t;await e.boot(),l.host(e)}await v("boot");let a=new e;await a.boot(),l.app(a)},C=async()=>{tt.isWorker||await l.host().start(),await l.app().start()},A=()=>new Promise((t,e)=>{"loading"!==document.readyState?t():(!0).document.addEventListener("DOMContentLoaded",()=>{t()})}),S=()=>new Promise((t,e)=>{(!0).document.addEventListener("deviceready",()=>{t()},!1)}),k=async()=>{tt.isClient&&!tt.isWorker&&(await A(),tt.isCordova&&await S()),tt.isWorker||await l.host().ready(),await v("ready"),await l.app().ready()};return await n(),await p(),await f(),await c(),await y(),await m(),await w(),await g(),await b(),await I(),await C(),await k(),console.log("ready!"),!0}})})(),await(async()=>{const{Bootware:t}=await T("flair.app");c("sealed"),c("ns","flair.boot"),a("DIContainer",t,function(){c("override"),this.construct=(t=>{t("DI Container")}),c("override"),this.boot=(async t=>{t();let e=xt.di.container;for(let t in e)e.hasOwnProperty(t)&&h.register(t,e[t])})})})(),await(async()=>{const{Attribute:t}=await T();c("ns","flair.app.ajax"),a("FetchAttr",t,function(){c("override"),this.construct=((t,e,a,i,r)=>{t(e,a,r),this.connection=xt.api.connections[e]||{options:{}},this.options=this.connection.options[a]||{},this.dataType=i||"text",this.path=r||"",this.fetchHandler=d(ot("serverFetch | clientFetch")),this.constraints="(class || struct) && (func && async) && !($inject || $on || @fetch)"}),c("readonly"),this.connection=null,c("readonly"),this.options=null,c("readonly"),this.path=null,c("private"),this.fetchHandler=null,c("override"),this.decorateFunction=((t,e,a,i)=>{let r=this,s=(t,e,a)=>{if(-1!==t.indexOf(e)){let i=`/:${e}?`;if(-1!==t.indexOf(i)&&(t=it(t,e,a?`/${encodeURIComponent(a.toString())}`:"")),i=`/:${e}`,-1!==t.indexOf(i)){if(!a)throw J.InvalidDefinition(e);t=it(t,e,`/${encodeURIComponent(a.toString())}`)}}return t},n=t=>{let e=r.connection.url.trim(),a=r.path;if(e){if(e.endsWith("/")||(e+="/"),a&&(a.startsWith("/")&&(a=a.substr(1)),e+=a),t){for(let a in t)t.hasOwnProperty(a)&&-1===["query","abortable","options"].indexOf(a)&&(e=it(e,a,t[a]));let a=tt.props("api");for(let t in a)e=s(e,t,a[t])}if(t.query){let a="?",i=null;for(let e in t.query)t.query.hasOwnProperty(e)&&(a+=`${e}=${i=encodeURIComponent(t.query[e].toString())}&`);"?"!==a&&(a.endsWith("&")&&(a=a.substr(0,a.length-1)),e+=a)}}return e};return async function(...t){let s=t=>{let i=t.abortable?new AbortController:null,s=null,o=new Promise((o,l)=>{s=l;let c=n(t);if(!c)return void l(J.InvalidDefinition(`${e}::${a}::fetch`));let f=pt([r.options,t.options||{}],!0);i&&(f.signal=i.signal),r.fetchHandler(c,r.dataType,f).then(t=>{o(t)}).catch(l)});return i&&(o.abort=(()=>{i.abort(),s()})),o};return await i(...t)}})})})(),await(async()=>{const{IPortHandler:t}=await T("flair.app");c("sealed"),c("ns","flair.app.ajax"),a("FetchPort",[t],function(){this.construct=(()=>{this.port=ot("serverFetch | clientFetch"),this.factory=tt.isServer?this.serverFetch:this.clientFetch,d.define(this.port,this.factory)}),c("readonly"),this.port=null,c("readonly"),this.interface=null,c("private"),this.fetcher=(async(t,e,a,i)=>{if("string"!=typeof e)throw J.InvalidArgument("url");if("string"!=typeof a||-1===["text","json","buffer","form","blob"].indexOf(a))throw J.InvalidArgument("resDataType");if(!i)throw J.InvalidArgument("reqData");let r=await t(e,i);if(!r.ok)throw J.OperationFailed(e,r.status);let s="";switch(a){case"text":s="text";break;case"json":s="json";break;case"buffer":s="arrayBuffer";break;case"form":s="formData";break;case"blob":s="blob";break}return await r[s]()}),c("private"),this.serverFetchFactory=(t=>(t,e,a)=>this.fetcher(require("node-fetch"),t,e,a)),c("private"),this.clientFetchFactory=(t=>(t,e,a)=>this.fetcher(fetch,t,e,a)),this.factory=(t=>tt.isServer?this.serverFetchFactory(t):this.clientFetchFactory(t))})})(),await(async()=>{c("static"),c("ns","flair.app.caching"),a("Cache",function(){this.construct=(()=>{this.cacheHandler=d("cacheHandler")}),c("private"),this.cacheHandler=null,this.get=(async t=>{}),this.set=(async(t,e)=>{}),this.remove=(async t=>{})})})(),await(async()=>{const{Attribute:t}=await T();c("ns","flair.app.caching"),a("CacheAttr",t,function(){c("override"),this.construct=((t,e)=>{t(e),this.cacheConfig="number"==typeof e?{duration:e}:e,this.enabled=this.cacheConfig&&this.cacheConfig.duration,this.cacheHandler=d("cacheHandler"),this.constraints="(class || struct) && (func && async) && !(timer || on || @fetch || @cache)"}),c("readonly"),this.cacheConfig=null,c("private"),this.cacheHandler=null,c("private"),this.enabled=!1,c("override"),this.decorateFunction=((t,e,a,i)=>{let r=this,s=`${e}___${a}`,n=async(...t)=>{let e=await i(...t);return r.enabled&&await r.cacheHandler.set(s,r.cacheConfig,e),e};return async function(...t){if(r.enabled)try{return await r.cacheHandler.get(s,r.cacheConfig)}catch(t){}return await n(...t)}})})})(),await(async()=>{c("ns","flair.app.caching"),i("CacheItem",function(){this.construct=((t,e)=>{this.id=t,this.config="number"==typeof e?{duration:e}:e}),c("readonly"),this.id=null,c("readonly"),this.config=null})})(),await(async()=>{const{IPortHandler:t}=await T("flair.app");c("sealed"),c("ns","flair.app.caching"),a("CachePort",[t],function(){this.construct=(()=>{this.port="cacheHandler",this.interface=["get","set","remove"],d.define(this.port,this.interface,this.cacheHandler)}),c("readonly"),this.port=null,c("readonly"),this.interface=null,this.factory=(t=>{let e=d("localStorage"),a="__cache_",i="__savedAt_",r;return{get:async(t,r)=>{if("string"!=typeof t)throw J.InvalidArgument("cacheId");if(!r||!r.duration)throw J.InvalidArgument("cacheConfig");let s=`${a}${t}`,n=`${s}${i}`,o=JSON.parse(e.getItem(s)).value,l=parseInt(e.getItem(n));if(Date.now()-l<=r.duration)return o;throw e.removeItem(s),e.removeItem(n),J.NotFound(t)},set:async(t,r,s)=>{if("string"!=typeof t)throw J.InvalidArgument("cacheId");if(!r)throw J.InvalidArgument("cacheConfig");if(void 0===s)throw J.InvalidArgument("fetchedData");let n=`${a}${t}`,o=`${n}${i}`,l=JSON.stringify({value:s}),c=Date.now().toString();e.setItem(n,l),e.setItem(o,c)},remove:async(t,r)=>{if("string"!=typeof t)throw J.InvalidArgument("cacheId");if(!r)throw J.InvalidArgument("cacheConfig");let s=`${a}${t}`,n=`${s}${i}`;e.removeItem(s),e.removeItem(n)}}})})})(),await(async()=>{c("ns","flair.app"),s("IPortHandler",function(){this.port=K,this.interface=K,this.factory=Q})})(),l.context.current().currentAssemblyBeingLoaded("","function"==typeof At?At:null),l.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.60.18","lupdate":"Wed, 25 Sep 2019 00:20:53 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.app.Bootware","flair.app.HandlerContext","flair.app.Payload","flair.app.Handler","flair.app.App","flair.app.HandlerResult","flair.app.Host","flair.app.BootEngine","flair.boot.DIContainer","flair.app.ajax.FetchAttr","flair.app.ajax.FetchPort","flair.app.caching.Cache","flair.app.caching.CacheAttr","flair.app.caching.CacheItem","flair.app.caching.CachePort","flair.app.IPortHandler"],"resources":[],"assets":[],"routes":[]}'),Object.freeze({name:"flair.app",settings:xt,config:Ct})});