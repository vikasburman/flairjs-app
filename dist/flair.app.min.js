/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.60.32
 *  Sat, 28 Sep 2019 02:07:49 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(t,e){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>e):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e):t["flair.app"]=e}(this,async function(t,e){"use strict";const{Class:a,Struct:i,Enum:s,Interface:r,Mixin:n,Aspects:o,AppDomain:l,$$:c,InjectedArg:h,bring:p,Container:f,include:u,Port:d,on:m,post:y,telemetry:w,Reflector:g,Serializer:b,Tasks:v,as:I,is:S,isDefined:x,isComplies:P,isDerivedFrom:k,isAbstract:A,isSealed:O,isStatic:N,isSingleton:C,isDeprecated:T,isImplements:j,isInstanceOf:E,isMixed:$,getAssembly:F,getAttr:H,getContext:D,getResource:L,getRoute:W,getType:_,ns:B,getTypeOf:M,getTypeName:R,typeOf:J,dispose:q,using:V,Args:z,Exception:U,noop:G,nip:K,nim:Q,nie:X,event:Y}=t,{TaskInfo:Z}=t.Tasks,{env:tt}=t.options,{guid:et,stuff:at,replaceAll:it,splitAndTrim:st,findIndexByProp:rt,findItemByProp:nt,which:ot,isArrowFunc:lt,isASyncFunc:ct,sieve:ht,deepMerge:pt,getLoadedScript:ft,b64EncodeUnicode:ut,b64DecodeUnicode:dt,lens:mt,globalSetting:yt}=t.utils,wt=tt.isServer||tt.isWorker?null:(!0).document,gt=l.context.current().name,bt=e,vt=bt.substr(0,bt.lastIndexOf("/")+1);l.loadPathOf("flair.app",vt);let It=JSON.parse('{"host":"flair.app.ServerHost | flair.app.ClientHost","app":"flair.app.App","boot":{"env":{"isVue":true,"isServerless":false,"isFirebase":false},"links":[],"scripts":[],"meta":[],"preambles":[],"assemblies":[],"ports":[],"attributes":[],"aspects":[],"bootwares":[],"di":{"container":{}},"cache":{"TTL":0,"slidingTTL":true}},"api":{"connections":{}}}'),St=d("settingsReader");if("function"==typeof St){let t=St("flair.app");t&&(It=pt([It,t],!1))}It=Object.freeze(It);let xt=JSON.parse("{}");xt=Object.freeze(xt);const Pt=t=>{d.define("sessionStorage",["key","getItem","setItem","removeItem","clear"]),d.define("stateStorage",["key","getItem","setItem","removeItem","clear"]),d.define("cacheStorage",["key","getItem","setItem","removeItem","clear"]),d.define("fetchHandler",["fetch"])};return l.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),await(async()=>{c("abstract"),c("ns","flair.app"),a("Bootware",function(){c("virtual"),this.construct=(t=>{this.isMountSpecific=t||!1}),c("virtual"),c("async"),this.boot=G,c("readonly"),this.isMountSpecific=!1,c("virtual"),c("async"),this.ready=G,c("virtual"),this.dispose=G,c("protected"),this.getMountSpecificSettings=((t,e,a,i)=>{let s=[];if(e.all&&e.all.before&&e.all.before[t]&&s.push(...e.all.before[t]),e[a]&&e[a][t])if(0===s.length)s.push(...e[a][t]);else if(i)for(let r of e[a][t]){let t=nt(s,i,r[i]);if(null!==t)for(let e in r)t[e]=r[e];else s.push(r)}else for(let i of e[a][t])"string"==typeof i&&-1!==s.indexOf(i)||s.push(i);if(e.all&&e.all.after&&e.all.after[t])if(0===s.length)s.push(...e.all.after[t]);else if(i)for(let a of e.all.after[t]){let t;null!==nt(s,i,a[i])||s.push(a)}else for(let a of e.all.after[t])"string"==typeof a&&-1!==s.indexOf(a)||s.push(a);return s})})})(),await(async()=>{c("ns","flair.app"),a("Payload",function(){c("virtual"),this.construct=((t,e,a,i)=>{this.data=t||null,this.status=e||null,Array.isArray(i)&&this.resHeaders.push(...i),a&&this.resHeaders.push({name:"Content-Type",value:a||"text/plain"})}),c("readonly"),this.data=null,c("readonly"),this.status=null,c("readonly"),this.resHeaders=[]})})(),await(async()=>{c("ns","flair.app"),a("HandlerContext",function(){c("virtual"),this.construct=(()=>{}),c("private"),this.items={},this.getData=((t,e)=>this.items[t]||e),this.setData=((t,e)=>{this.items[t]=e})})})(),await(async()=>{const{IDisposable:t}=await B();c("ns","flair.app"),a("Handler",[t],function(){c("virtual"),this.construct=(t=>{this.route=l.context.current().getRoute(t.name)}),c("protected"),this.route=null,c("virtual"),c("async"),this.run=G,c("virtual"),this.dispose=G})})(),await(async()=>{const{IDisposable:t}=await B(),{Bootware:e}=await B("flair.app");c("ns","flair.app"),a("App",e,[t],function(){c("override"),this.construct=(t=>{let e=F(this.$Type);t(e.title,e.version)}),c("override"),c("sealed"),this.boot=(async t=>{t(),l.host().error.add(this.handleError)}),this.start=(async()=>{if(!tt.isServer&&!tt.isWorker){const{ViewState:t}=await B("flair.ui");new t}await this.onStart()}),c("virtual"),c("async"),this.onStart=G,c("override"),c("sealed"),this.ready=(async()=>{await this.onReady()}),c("virtual"),c("async"),this.onReady=G,this.stop=(async()=>{if(!tt.isServer&&!tt.isWorker){const{ViewState:t}=await B("flair.ui");(new t).clear()}await this.onStop()}),c("virtual"),c("async"),this.onStop=G,c("private"),this.handleError=(t=>{this.onError(t.args.error)}),c("virtual"),this.onError=(t=>{throw U.OperationFailed(t,this.onError)}),c("virtual"),this.getRoutingContext=G,c("override"),this.dispose=(t=>{t(),l.host().error.remove(this.handleError)})})})(),await(async()=>{const{Payload:t}=await B("flair.app");c("ns","flair.app"),a("HandlerResult",function(){c("virtual"),this.construct=((e,a,i)=>{let s=200,r="OK",n="Exception";if(a&&S(a,t)&&(s=a.status||s,this.isExtendedPayload=!0),e&&e.name)switch(r=e.name||(tt.isServer?"InternalServerError":"InternalClientError"),e.name){case"Continue"+n:s=100;break;case"NoContent"+n:s=204;break;case"Redirect"+n:s=302;break;case"NotModified"+n:s=304;break;case"InvalidArgument"+n:case"InvalidOperation"+n:s=406;break;case"Unauthorized"+n:s=401;break;case"NotFound"+n:s=404;break;case"NotAllowed"+n:case"NotAvailable"+n:case"NotSupported"+n:s=405;break;case"OperationConflict"+n:case"Duplicate"+n:s=409;break;case"NotImplemented"+n:case"NotDefined"+n:s=501;break;default:s=500;break}this.status=s,this.message=r,this.isError=!!e,e&&tt.isDebug&&(this.message+=`\n${e.message||""}`,this.message+=`\n${e.stack||""}`),this.data=a||null,Array.isArray(i)&&this.resHeaders.push(...i)}),c("private"),this.isExtendedPayload=!1,c("readonly"),this.status=500,c("readonly"),this.message="",c("readonly"),this.isError=!1,c("readonly"),this.data=null,c("readonly"),this.resHeaders=[],this.value=(t=>t&&!this.isError?Object.freeze({data:this.isExtendedPayload?this.data.data:this.data}):Object.freeze({isError:this.isError,status:this.status,message:this.message,data:this.isExtendedPayload?this.data.data:this.data}))})})(),await(async()=>{const{IDisposable:t}=await B(),{Bootware:e}=await B("flair.app");c("ns","flair.app"),a("Host",e,[t],function(){c("virtual"),c("async"),this.start=G,c("virtual"),c("async"),this.stop=G,this.error=Y(t=>({error:t})),this.raiseError=(t=>{this.error(t)})})})(),await(async()=>{c("ns","flair.app"),a("Middleware",function(){c("virtual"),c("async"),this.run=G})})(),await(async()=>{const{IPortHandler:t}=await B();c("ns","flair.app.ajax"),a("FetchPort",[t],function(){this.construct=(()=>{tt.isServer?this.handler=require("node-fetch"):this.handler=fetch}),c("private"),this.handler=null,c("readonly"),this.name="fetchHandler",this.fetch=(async(t,e,a)=>{if("string"!=typeof t)throw U.InvalidArgument("url");if("string"!=typeof e||-1===["text","json","buffer","form","blob"].indexOf(e))throw U.InvalidArgument("dataType");if(!a)throw U.InvalidArgument("opts");let i=await this.handler(t,a);if(!i.ok)throw U.OperationFailed(t,i.status);let s="";switch(e){case"text":s="text";break;case"json":s="json";break;case"buffer":s="arrayBuffer";break;case"form":s="formData";break;case"blob":s="blob";break}return await i[s]()})})})(),await(async()=>{const{IPortHandler:t}=await B();c("ns","flair.app.caching"),a("CachePort",[t],function(){this.construct=(()=>{const t=function(){let t=null,e={};const a=function(t,a=e.stdTTL){let i=t,s=Date.now(),r=s+a;this.value=(()=>t||null),this.ttl=(()=>a),this.created=(()=>s),this.isExpired=(()=>Date.now()>r),this.toJSONString=(()=>JSON.stringify({v:i,t:a,c:s}))};if(a.fromJSONString=(t=>{if(!t)return null;let e=JSON.parse(t);return new a(e.value(),e.created(),e.ttl())}),tt.isServer){const i=require("node-cache");e={stdTTL:It.boot.cache.TTL,errorOnMissing:!1,checkperiod:0,useClones:!0,deleteOnExpire:!1},t=new i(e),this.key=(async t=>!!await this.getItem(t)),this.getItem=(async e=>{if(!e)return null;let i=a.fromJSONString(t.get(e));return i?i.isExpired()?(await this.removeItem(e),null):(It.boot.cache.slidingTTL&&await this.setItem(e,i.value(),i.ttl()),i.value()):null}),this.setItem=(async(i,s,r=e.stdTTL)=>{if(!i)return!1;let n=new a(s,r);return t.set(i,n.toJSONString())}),this.removeItem=(async e=>!!e&&t.del(e)>0),this.keys=(async()=>t.keys())}else e={stdTTL:It.boot.cache.TTL},t=(!0).localStorage,this.key=(async t=>!!await this.getItem(t)),this.getItem=(async e=>{if(!e)return null;let i=a.fromJSONString(t.getItem(e));return i?i.isExpired()?(await this.removeItem(e),null):(It.boot.cache.slidingTTL&&await this.setItem(e,i.value(),i.ttl()),i.value()):null}),this.setItem=(async(i,s,r=e.stdTTL)=>{if(!i)return!1;let n=new a(s,r);return t.setItem(i,n.toJSONString())}),this.removeItem=(async e=>!!e&&(!!t[e]&&(t.removeItem(e),!0))),this.keys=(async()=>Object.keys(t))};this.handler=new t}),c("private"),this.handler=null,c("private"),this.itemNamePrefix="__cache_",c("readonly"),this.name="cacheStorage",this.key=(async t=>await this.handler.key(this.itemNamePrefix+t)),this.getItem=(async t=>await this.handler.getItem(this.itemNamePrefix+t)),this.setItem=(async(t,e)=>await this.handler.setItem(this.itemNamePrefix+t,e)),this.removeItem=(async t=>await this.handler.removeItem(this.itemNamePrefix+t)),this.clear=(async()=>{let t=await this.handler.keys();for(let e of t)e.startsWith(this.itemNamePrefix)&&await this.handler.removeItem(e)})})})(),await(async()=>{const{IPortHandler:t}=await B();c("ns","flair.app.caching"),a("SessionPort",[t],function(){this.construct=(()=>{this.handler=(tt.isServer,(!0).sessionStorage)}),c("private"),this.handler=null,c("private"),this.itemNamePrefix="__session_",c("readonly"),this.name="sessionStorage",this.key=(async t=>this.handler.key(this.itemNamePrefix+t)),this.getItem=(async t=>this.handler.getItem(this.itemNamePrefix+t)),this.setItem=(async(t,e)=>this.handler.setItem(this.itemNamePrefix+t,e)),this.removeItem=(async t=>this.handler.removeItem(this.itemNamePrefix+t)),this.clear=(async()=>{let t=Object.keys(this.handler);for(let e of t)e.startsWith(this.itemNamePrefix)&&this.handler.removeItem(e)})})})(),await(async()=>{const{IPortHandler:t}=await B();c("ns","flair.app.caching"),a("StatePort",[t],function(){this.construct=(()=>{this.handler=tt.isServer?require("node-localstorage"):(!0).localStorage}),c("private"),this.handler=null,c("private"),this.itemNamePrefix="__state_",c("readonly"),this.name="stateStorage",this.key=(async t=>this.handler.key(this.itemNamePrefix+t)),this.getItem=(async t=>this.handler.getItem(this.itemNamePrefix+t)),this.setItem=(async(t,e)=>this.handler.setItem(this.itemNamePrefix+t,e)),this.removeItem=(async t=>this.handler.removeItem(this.itemNamePrefix+t)),this.clear=(async()=>{if(tt.isServer)this.handler.clear();else{let t=Object.keys((!0).localStorage);for(let e of t)e.startsWith(this.itemNamePrefix)&&this.handler.removeItem(e)}})})})(),await(async()=>{const{SessionPort:t}=await B("flair.app.caching");c("singleton"),c("ns","flair.app.caching"),a("Session",[t],function(){})})(),await(async()=>{const{IAttribute:t}=await B();c("sealed"),c("ns","flair.app.ajax"),a("FetchAttr",[t],function(){this.construct=(()=>{this.port=d("fetchHandler")}),c("private"),this.port=null,c("readonly"),this.name="fetch",c("readonly"),this.constraints="(class || struct) && (func && async) && !($inject || $on || @fetch)",this.decorateFunction=((t,e,a,i,s,r,n)=>{let o=this,l=It.api.connections[i]||{options:{}},c=l.options[s]||{},p=l.url||"",f=(t,e,a)=>{if(-1!==t.indexOf(e)){let i=`/:${e}?`;if(-1!==t.indexOf(i)&&(t=it(t,i,a?`/${encodeURIComponent(a.toString())}`:"")),i=`/:${e}`,-1!==t.indexOf(i)){if(!a)throw U.InvalidDefinition(e);t=it(t,i,`/${encodeURIComponent(a.toString())}`)}}return t},u=t=>{if(p){if(p.endsWith("/")||(p+="/"),n&&(n.startsWith("/")&&(n=n.substr(1)),p+=n),t){for(let e in t)t.hasOwnProperty(e)&&-1===["query","abortable","options"].indexOf(e)&&(p=f(p,e,t[e]));let e=tt.props("api");for(let t in e)p=f(p,t,e[t])}if(t.query){let e="?",a=null;for(let i in t.query)t.query.hasOwnProperty(i)&&(e+=`${i}=${a=encodeURIComponent(t.query[i].toString())}&`);"?"!==e&&(e.endsWith("&")&&(e=e.substr(0,e.length-1)),p+=e)}}return p};return async function(...i){let s,n=[new h(a=>{let i=a.abortable?new AbortController:null,s=null,n=new Promise((n,l)=>{if(s=l,u(a),!p)return void l(U.InvalidDefinition(`${t}::${e}::fetch`));let h=pt([c,a.options||{}],!0);i&&(h.signal=i.signal),o.port.fetch(p,r,h).then(n).catch(l)});return i&&(n.abort=(()=>{i.abort(),s()})),n})];return i&&n.push(...i),await a(...n)}})})})(),await(async()=>{const{FetchPort:t}=await B("flair.app.ajax");c("singleton"),c("ns","flair.app.ajax"),a("Fetch",[t],function(){})})(),await(async()=>{const{StatePort:t}=await B("flair.app.caching");c("singleton"),c("ns","flair.app.caching"),a("State",[t],function(){})})(),await(async()=>{const{CachePort:t}=await B("flair.app.caching");c("singleton"),c("ns","flair.app.caching"),a("Cache",[t],function(){})})(),await(async()=>{const{Bootware:t}=await B("flair.app");c("sealed"),c("ns","flair.app.bw"),a("DIContainer",t,function(){c("override"),this.boot=(async t=>{t();let e=It.boot.di.container;for(let t in e)e.hasOwnProperty(t)&&f.register(t,e[t])})})})(),await(async()=>{const{IPortHandler:e,IAttribute:i}=await B(),{Bootware:s}=await B("flair.app");c("static"),c("ns","flair.app"),a("BootEngine",function(){this.start=async function(){let a=[],r=[];const n=async()=>{tt.x(It.boot.env)},o=(t,e)=>{let a=null,i=null,s=!1,r=!1,n=(!0).document.getElementsByTagName("head")[0];for(let o of t){a=document.createElement(e),s=!1,r=!1;for(let t in o)o.hasOwnProperty(t)&&(i=o[t],-1!==["src","href"].indexOf(t)&&((i=ot(i))||(r=!0)),s=!0,a.setAttribute(t,i));s&&!r&&n.appendChild(a)}},h=async()=>{if(tt.isClient&&!tt.isWorker){let t=[];t.push(...It.boot.scripts),o(t,"script")}},p=async()=>{if(tt.isClient&&!tt.isWorker){let t=[];t.push(...It.boot.links),o(t,"link")}},f=async()=>{if(tt.isClient&&!tt.isWorker){let e=[{name:"BuiltWith",content:`${t.info.name}`}];e.push(...It.boot.meta),o(e,"meta")}},m=async()=>{let e=null,a=null;(e=[]).push(...It.boot.preambles);for(let i of e)(i=ot(i))&&(i.endsWith("/")||(i+="/"),i+="preamble{.min}.js",a=await u(i),await a(t))},y=async()=>{let t=null,a=null;(t=["flair.app.logging.LogPort","flair.app.ajax.FetchPort","flair.app.caching.SessionPort","flair.app.caching.StatePort","flair.app.caching.CachePort"]).push(...It.boot.ports);for(let i of t)(i=ot(i))&&(a=I(await u(i),e),d.connect(new a))},w=async()=>{let t=null,e=null;(t=["flair.app.ajax.FetchAttr","flair.app.caching.SessionAttr","flair.app.caching.StateAttr","flair.app.caching.CacheAttr"]).push(...It.boot.attributes);for(let a of t)(a=ot(a))&&(e=I(await u(a),i))&&c.register(new e)},g=async()=>{},b=async()=>{let t=["./flair.app{.min}.js","./flair.server{.min}.js | ./flair.client{.min}.js","x | isVue::./flair.client.vue{.min}.js","isFirebase::./flair.server.firebase{.min}.js | x"];t.push(...It.boot.assemblies);for(let e of t)(e=ot(e))&&await l.context.loadAssembly(e)},v=async()=>{let t=null,e=null,i=null;(t=["flair.app.bw.NodeEnv ~ x | x","flair.app.bw.Middlewares ~ x | x","flair.app.bw.DIContainer","x | isVue::flair.app.bw.VueSetup ~ x","flair.app.bw.ServerRouter ~ x | flair.app.bw.ClientRouter | x"]).push(...It.boot.bootwares);for(let n of t)(n=ot(n))&&(e=I(await u(n),s))&&(i=new e,a.push(i),i.isMountSpecific&&r.push(i))},S=async t=>{if(tt.isWorker){0!==r.length&&console.warn("Mount specific bootwares are not supported for worker environment. Revisit worker:flair.app->load setting.");for(let e of a)e.isMountSpecific||await e[t]()}else{let e=l.host().mounts,i=Object.keys(e),s="",n=null;n=e[s="main"];for(let e of a)await e[t](n);for(let a of i)if("main"!==a){n=e[a];for(let e of r)await e[t](n)}}},x=async()=>{const t=await u(It.host),e=await u(It.app);if(!tt.isWorker){let e=new t;await e.boot(),l.host(e)}await S("boot");let a=new e;await a.boot(),l.app(a)},P=async()=>{tt.isWorker||await l.host().start(),await l.app().start()},k=()=>new Promise((t,e)=>{"loading"!==document.readyState?t():(!0).document.addEventListener("DOMContentLoaded",()=>{t()})}),A=()=>new Promise((t,e)=>{(!0).document.addEventListener("deviceready",()=>{t()},!1)}),O=async()=>{tt.isClient&&!tt.isWorker&&(await k(),tt.isCordova&&await A()),tt.isWorker||await l.host().ready(),await S("ready"),await l.app().ready()};return await n(),await f(),await p(),await h(),await m(),await y(),await w(),await g(),await b(),await v(),await x(),await P(),await O(),console.log("ready!"),!0}})})(),await(async()=>{const{IAttribute:t}=await B();c("sealed"),c("ns","flair.app.caching"),a("CacheAttr",[t],function(){this.construct=(()=>{this.port=d("cacheStorage")}),c("private"),this.port=null,c("readonly"),this.name="cache",c("readonly"),this.constraints="(class || struct) && (func && async) && !(timer || on || @cache)",this.decorateFunction=((t,e,a,i)=>{let s=this,r=`${t}___${e}`,n=async(...t)=>{let e=await a(...t);return await s.port.setItem(r,e,i),e};return async function(...t){let e=await s.port.getItem(r);return null!==e?e:await n(...t)}})})})(),await(async()=>{const{IAttribute:t}=await B();c("sealed"),c("ns","flair.app.caching"),a("SessionAttr",[t],function(){this.construct=(()=>{this.port=d("sessionStorage")}),c("private"),this.port=null,c("readonly"),this.name="session",c("readonly"),this.constraints="(class && prop) && !($static || $state || $readonly || $abstract || $virtual)",this.decorateFunction=((t,e,a,i)=>{let s=this,r=`${t}___${e}`,n=async(...t)=>{let e=await a(...t);return await s.port.setItem(r,e,i),e};return async function(...t){let e=await s.port.getItem(r);return null!==e?e:await n(...t)}})})})(),await(async()=>{const{IAttribute:t}=await B(),{State:e}=await B("flair.app.caching");c("sealed"),c("ns","flair.app.caching"),a("StateAttr",[t],function(){c("readonly"),this.name="state",c("readonly"),this.constraints="(class && prop) && !($static || $session || $readonly || $abstract || $virtual)",this.decorateFunction=((t,a,i,s)=>{let r=`${t}___${a}`,n=async(...t)=>{let a=await i(...t);return await e.setItem(r,a,s),a};return async function(...t){let a=await e.getItem(r);return null!==a?a:await n(...t)}})})})(),await(async()=>{const{IPortHandler:t}=await B();c("ns","flair.app.logging"),a("LogPort",[t],function(){})})(),l.context.current().currentAssemblyBeingLoaded("","function"==typeof Pt?Pt:null),l.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.60.32","lupdate":"Sat, 28 Sep 2019 02:07:49 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.app.Bootware","flair.app.Payload","flair.app.HandlerContext","flair.app.Handler","flair.app.App","flair.app.HandlerResult","flair.app.Host","flair.app.Middleware","flair.app.ajax.FetchPort","flair.app.caching.CachePort","flair.app.caching.SessionPort","flair.app.caching.StatePort","flair.app.caching.Session","flair.app.ajax.FetchAttr","flair.app.ajax.Fetch","flair.app.caching.State","flair.app.caching.Cache","flair.app.bw.DIContainer","flair.app.BootEngine","flair.app.caching.CacheAttr","flair.app.caching.SessionAttr","flair.app.caching.StateAttr","flair.app.logging.LogPort"],"resources":[],"assets":[],"routes":[]}'),Object.freeze({name:"flair.app",settings:It,config:xt})});