/**
 * @preserve
 * Flair.js Fabric
 * Foundation for True Object Oriented JavaScript Apps
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.60.22
 *  Wed, 25 Sep 2019 04:57:42 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(t,e){"use strict";"function"==typeof!0&&(!0).amd?(!0)(()=>e):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e):t["flair.app"]=e}(this,async function(t,e){"use strict";const{Class:a,Struct:i,Enum:r,Interface:s,Mixin:n,Aspects:o,AppDomain:l,$$:c,attr:f,InjectedArg:p,bring:h,Container:u,include:d,Port:y,on:m,post:w,telemetry:b,Reflector:g,Serializer:v,Tasks:x,as:I,is:A,isDefined:C,isComplies:S,isDerivedFrom:k,isAbstract:O,isSealed:E,isStatic:F,isSingleton:j,isDeprecated:H,isImplements:P,isInstanceOf:$,isMixed:D,getAssembly:R,getAttr:B,getContext:W,getResource:M,getRoute:N,getType:T,ns:_,getTypeOf:z,getTypeName:L,typeOf:V,dispose:q,using:U,Args:J,Exception:G,noop:K,nip:Q,nim:X,nie:Y,event:Z}=t,{TaskInfo:tt}=t.Tasks,{env:et}=t.options,{guid:at,stuff:it,replaceAll:rt,splitAndTrim:st,findIndexByProp:nt,findItemByProp:ot,which:lt,isArrowFunc:ct,isASyncFunc:ft,sieve:pt,deepMerge:ht,getLoadedScript:ut,b64EncodeUnicode:dt,b64DecodeUnicode:yt,lens:mt,globalSetting:wt}=t.utils,bt=et.isServer||et.isWorker?null:(!0).document,gt=l.context.current().name,vt=e,xt=vt.substr(0,vt.lastIndexOf("/")+1);l.loadPathOf("flair.app",xt);let It=JSON.parse('{"host":"flair.app.ServerHost | flair.app.ClientHost","app":"flair.app.App","boot":{"env":{"isVue":false,"isExpress":false,"isServerless":false,"isFirebase":false},"links":[],"scripts":[],"meta":[],"preambles":[],"ports":[],"bootwares":[],"assemblies":[],"attributes":[]},"di":{"container":{}},"api":{"connections":{}}}'),At=y("settingsReader");if("function"==typeof At){let t=At("flair.app");t&&(It=ht([It,t],!1))}It=Object.freeze(It);let Ct=JSON.parse("{}");return Ct=Object.freeze(Ct),l.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),await(async()=>{c("abstract"),c("ns","flair.app"),a("Bootware",function(){c("virtual"),this.construct=((t,e,a)=>{let i=J("name: string, version: string","name: string, version: string, isMountSpecific: boolean","name: string, isMountSpecific: boolean","name: string")(t,e,a);i.throwOnError(this.construct),this.info=Object.freeze({name:i.values.name||"",version:i.values.version||"",isMountSpecific:i.values.isMountSpecific||!1})}),c("virtual"),c("async"),this.boot=K,c("readonly"),this.info=null,c("virtual"),c("async"),this.ready=K,c("virtual"),this.dispose=K,c("protected"),this.getMountSpecificSettings=((t,e,a,i)=>{let r=[];if(e.all&&e.all.before&&e.all.before[t]&&r.push(...e.all.before[t]),e[a]&&e[a][t])if(0===r.length)r.push(...e[a][t]);else if(i)for(let s of e[a][t]){let t=ot(r,i,s[i]);if(null!==t)for(let e in s)t[e]=s[e];else r.push(s)}else for(let i of e[a][t])"string"==typeof i&&-1!==r.indexOf(i)||r.push(i);if(e.all&&e.all.after&&e.all.after[t])if(0===r.length)r.push(...e.all.after[t]);else if(i)for(let a of e.all.after[t]){let t;null!==ot(r,i,a[i])||r.push(a)}else for(let a of e.all.after[t])"string"==typeof a&&-1!==r.indexOf(a)||r.push(a);return r})})})(),await(async()=>{c("ns","flair.app"),a("HandlerContext",function(){c("virtual"),this.construct=(()=>{}),c("private"),this.items={},this.getData=((t,e)=>this.items[t]||e),this.setData=((t,e)=>{this.items[t]=e})})})(),await(async()=>{c("ns","flair.app"),a("Payload",function(){c("virtual"),this.construct=((t,e,a,i)=>{this.data=t||null,this.status=e||null,Array.isArray(i)&&this.resHeaders.push(...i),a&&this.resHeaders.push({name:"Content-Type",value:a||"text/plain"})}),c("readonly"),this.data=null,c("readonly"),this.status=null,c("readonly"),this.resHeaders=[]})})(),await(async()=>{const{IDisposable:t}=await _();c("ns","flair.app"),a("Handler",[t],function(){c("virtual"),this.construct=(t=>{this.route=l.context.current().getRoute(t.name)}),c("protected"),this.route=null,c("virtual"),c("async"),this.run=K,c("virtual"),this.dispose=K})})(),await(async()=>{const{IDisposable:t}=await _(),{Bootware:e}=await _("flair.app");c("ns","flair.app"),a("App",e,[t],function(){c("override"),this.construct=(t=>{let e=R(this);t(e.title,e.version)}),c("override"),c("sealed"),this.boot=(async t=>{t(),l.host().error.add(this.handleError)}),this.start=(async()=>{if(!et.isServer&&!et.isWorker){const{ViewState:t}=await _("flair.ui");new t}await this.onStart()}),c("virtual"),c("async"),this.onStart=K,c("override"),c("sealed"),this.ready=(async()=>{await this.onReady()}),c("virtual"),c("async"),this.onReady=K,this.stop=(async()=>{if(!et.isServer&&!et.isWorker){const{ViewState:t}=await _("flair.ui");(new t).clear()}await this.onStop()}),c("virtual"),c("async"),this.onStop=K,c("private"),this.handleError=(t=>{this.onError(t.args.error)}),c("virtual"),this.onError=(t=>{throw G.OperationFailed(t,this.onError)}),c("virtual"),this.getRoutingContext=K,c("override"),this.dispose=(t=>{t(),l.host().error.remove(this.handleError)})})})(),await(async()=>{const{Payload:t}=await _("flair.app");c("ns","flair.app"),a("HandlerResult",function(){c("virtual"),this.construct=((e,a,i)=>{let r=200,s="OK",n="Exception";if(a&&A(a,t)&&(r=a.status||r,this.isExtendedPayload=!0),e&&e.name)switch(s=e.name||(et.isServer?"InternalServerError":"InternalClientError"),e.name){case"Continue"+n:r=100;break;case"NoContent"+n:r=204;break;case"Redirect"+n:r=302;break;case"NotModified"+n:r=304;break;case"InvalidArgument"+n:case"InvalidOperation"+n:r=406;break;case"Unauthorized"+n:r=401;break;case"NotFound"+n:r=404;break;case"NotAllowed"+n:case"NotAvailable"+n:case"NotSupported"+n:r=405;break;case"OperationConflict"+n:case"Duplicate"+n:r=409;break;case"NotImplemented"+n:case"NotDefined"+n:r=501;break;default:r=500;break}this.status=r,this.message=s,this.isError=!!e,e&&et.isDebug&&(this.message+=`\n${e.message||""}`,this.message+=`\n${e.stack||""}`),this.data=a||null,Array.isArray(i)&&this.resHeaders.push(...i)}),c("private"),this.isExtendedPayload=!1,c("readonly"),this.status=500,c("readonly"),this.message="",c("readonly"),this.isError=!1,c("readonly"),this.data=null,c("readonly"),this.resHeaders=[],this.value=(t=>t&&!this.isError?Object.freeze({data:this.isExtendedPayload?this.data.data:this.data}):Object.freeze({isError:this.isError,status:this.status,message:this.message,data:this.isExtendedPayload?this.data.data:this.data}))})})(),await(async()=>{const{IDisposable:t}=await _(),{Bootware:e}=await _("flair.app");c("ns","flair.app"),a("Host",e,[t],function(){c("virtual"),c("async"),this.start=K,c("virtual"),c("async"),this.stop=K,this.error=Z(t=>({error:t})),this.raiseError=(t=>{this.error(t)})})})(),await(async()=>{const{Bootware:t}=await _("flair.app");c("sealed"),c("ns","flair.boot"),a("DIContainer",t,function(){c("override"),this.construct=(t=>{t("DI Container")}),c("override"),this.boot=(async t=>{t();let e=It.di.container;for(let t in e)e.hasOwnProperty(t)&&u.register(t,e[t])})})})(),await(async()=>{c("ns","flair.app"),s("IPortHandler",function(){this.port=Q,this.interface=Q,this.factory=X})})(),await(async()=>{const{Attribute:t}=await _();c("ns","flair.app.ajax"),a("FetchAttr",t,function(){c("override"),this.construct=((t,e,a,i,r)=>{t(e,a,r),this.connection=It.api.connections[e]||{options:{}},this.options=this.connection.options[a]||{},this.dataType=i||"text",this.path=r||"",this.fetchHandler=y(lt("serverFetch | clientFetch")),this.constraints="(class || struct) && (func && async) && !($inject || $on || @fetch)"}),c("readonly"),this.connection=null,c("readonly"),this.options=null,c("readonly"),this.path=null,c("readonly"),this.dataType=null,c("private"),this.fetchHandler=null,c("override"),this.decorateFunction=((t,e,a,i)=>{let r=this,s=(t,e,a)=>{if(-1!==t.indexOf(e)){let i=`/:${e}?`;if(-1!==t.indexOf(i)&&(t=rt(t,e,a?`/${encodeURIComponent(a.toString())}`:"")),i=`/:${e}`,-1!==t.indexOf(i)){if(!a)throw G.InvalidDefinition(e);t=rt(t,e,`/${encodeURIComponent(a.toString())}`)}}return t},n=t=>{let e=r.connection.url.trim(),a=r.path;if(e){if(e.endsWith("/")||(e+="/"),a&&(a.startsWith("/")&&(a=a.substr(1)),e+=a),t){for(let a in t)t.hasOwnProperty(a)&&-1===["query","abortable","options"].indexOf(a)&&(e=rt(e,a,t[a]));let a=et.props("api");for(let t in a)e=s(e,t,a[t])}if(t.query){let a="?",i=null;for(let e in t.query)t.query.hasOwnProperty(e)&&(a+=`${e}=${i=encodeURIComponent(t.query[e].toString())}&`);"?"!==a&&(a.endsWith("&")&&(a=a.substr(0,a.length-1)),e+=a)}}return e};return async function(...t){let s,o=[new p(t=>{let i=t.abortable?new AbortController:null,s=null,o=new Promise((o,l)=>{s=l;let c=n(t);if(!c)return void l(G.InvalidDefinition(`${e}::${a}::fetch`));let f=ht([r.options,t.options||{}],!0);i&&(f.signal=i.signal),r.fetchHandler(c,r.dataType,f).then(t=>{o(t)}).catch(l)});return i&&(o.abort=(()=>{i.abort(),s()})),o})];return t&&o.push(...t),await i(...o)}})})})(),await(async()=>{const{IPortHandler:t}=await _("flair.app");c("sealed"),c("ns","flair.app.ajax"),a("FetchPort",[t],function(){this.construct=(()=>{this.port=lt("serverFetch | clientFetch"),y.define(this.port,this.factory)}),c("readonly"),this.port=null,c("readonly"),this.interface=null,c("private"),this.fetcher=(async(t,e,a,i)=>{if("string"!=typeof e)throw G.InvalidArgument("url");if("string"!=typeof a||-1===["text","json","buffer","form","blob"].indexOf(a))throw G.InvalidArgument("resDataType");if(!i)throw G.InvalidArgument("reqData");let r=await t(e,i);if(!r.ok)throw G.OperationFailed(e,r.status);let s="";switch(a){case"text":s="text";break;case"json":s="json";break;case"buffer":s="arrayBuffer";break;case"form":s="formData";break;case"blob":s="blob";break}return await r[s]()}),c("private"),this.serverFetchFactory=(t=>(t,e,a)=>this.fetcher(require("node-fetch"),t,e,a)),c("private"),this.clientFetchFactory=(t=>(t,e,a)=>this.fetcher(fetch,t,e,a)),this.factory=(t=>et.isServer?this.serverFetchFactory(t):this.clientFetchFactory(t))})})(),await(async()=>{const{Attribute:t}=await _();c("ns","flair.app.caching"),a("CacheAttr",t,function(){c("override"),this.construct=((t,e)=>{t(e),this.cacheConfig="number"==typeof e?{duration:e}:e,this.enabled=this.cacheConfig&&this.cacheConfig.duration,this.cacheHandler=y("cacheHandler"),this.constraints="(class || struct) && (func && async) && !(timer || on || @cache)"}),c("readonly"),this.cacheConfig=null,c("private"),this.cacheHandler=null,c("private"),this.enabled=!1,c("override"),this.decorateFunction=((t,e,a,i)=>{let r=this,s=`${e}___${a}`,n=async(...t)=>{let e=await i(...t);return r.enabled&&await r.cacheHandler.set(s,r.cacheConfig,e),e};return async function(...t){if(r.enabled)try{return await r.cacheHandler.get(s,r.cacheConfig)}catch(t){}return await n(...t)}})})})(),await(async()=>{const{IPortHandler:t}=await _("flair.app");c("sealed"),c("ns","flair.app.caching"),a("CachePort",[t],function(){this.construct=(()=>{this.port="cacheHandler",this.interface=["get","set","remove"],y.define(this.port,this.interface,this.factory)}),c("readonly"),this.port=null,c("readonly"),this.interface=null,this.factory=(t=>{let e=y("localStorage"),a="__cache_",i="__savedAt_",r;return{get:async(t,r)=>{if("string"!=typeof t)throw G.InvalidArgument("cacheId");if(!r||!r.duration)throw G.InvalidArgument("cacheConfig");let s=`${a}${t}`,n=`${s}${i}`,o=JSON.parse(e.getItem(s)).value,l=parseInt(e.getItem(n));if(Date.now()-l<=r.duration)return o;throw e.removeItem(s),e.removeItem(n),G.NotFound(t)},set:async(t,r,s)=>{if("string"!=typeof t)throw G.InvalidArgument("cacheId");if(!r)throw G.InvalidArgument("cacheConfig");if(void 0===s)throw G.InvalidArgument("fetchedData");let n=`${a}${t}`,o=`${n}${i}`,l=JSON.stringify({value:s}),c=Date.now().toString();e.setItem(n,l),e.setItem(o,c)},remove:async(t,r)=>{if("string"!=typeof t)throw G.InvalidArgument("cacheId");if(!r)throw G.InvalidArgument("cacheConfig");let s=`${a}${t}`,n=`${s}${i}`;e.removeItem(s),e.removeItem(n)}}})})})(),await(async()=>{const{Bootware:e,IPortHandler:i}=await _("flair.app"),{Attribute:r}=await _();c("static"),c("ns","flair.app"),a("BootEngine",function(){this.start=async function(){let a=[],s=[];const n=async()=>{et.x(It.boot.env)},o=(t,e)=>{let a=null,i=null,r=!1,s=!1,n=(!0).document.getElementsByTagName("head")[0];for(let o of t){a=document.createElement(e),r=!1,s=!1;for(let t in o)o.hasOwnProperty(t)&&(i=o[t],-1!==["src","href"].indexOf(t)&&((i=lt(i))||(s=!0)),r=!0,a.setAttribute(t,i));r&&!s&&n.appendChild(a)}},c=async()=>{if(et.isClient&&!et.isWorker){let t=[];t.push(...It.boot.scripts),o(t,"script")}},f=async()=>{if(et.isClient&&!et.isWorker){let t=[];t.push(...It.boot.links),o(t,"link")}},p=async()=>{if(et.isClient&&!et.isWorker){let e=[{name:"BuiltWith",content:`${t.info.name}`}];e.push(...It.boot.meta),o(e,"meta")}},h=async()=>{let e=null,a=null;(e=[]).push(...It.boot.preambles);for(let i of e)(i=lt(i))&&(i.endsWith("/")||(i+="/"),i+="preamble{.min}.js",a=await d(i),await a(t))},m=async()=>{let t=["./flair.app{.min}.js","./flair.server{.min}.js | ./flair.client{.min}.js","isExpress::./flair.server.express{.min}.js | isVue::./flair.client.vue{.min}.js","isFirebase::./flair.server.firebase{.min}.js | x"];t.push(...It.boot.assemblies);for(let e of t)(e=lt(e))&&await l.context.loadAssembly(e)},w=async()=>{let t=null,e=null,a=null;(t=["flair.app.ajax.FetchPort","flair.app.caching.CachePort"]).push(...It.boot.ports);for(let r of t)(r=lt(r))&&(e=await d(r),(a=I(new e,i))&&y.connect(a.port,a.factory))},b=async()=>{let t=null,e=null;(t=[{name:"fetch",type:"flair.app.ajax.FetchAttr"},{name:"cache",type:"flair.app.caching.CacheAttr"}]).push(...It.boot.attributes);for(let a of t)a.type=lt(a.type),a.name&&a.type&&!u.isRegistered(a.name)&&(e=I(await d(a.type),r))&&u.register(a.name,e)},g=async()=>{let t=null,i=null,r=null;(t=["flair.boot.NodeEnv ~ x | x","isExpress::flair.boot.Middlewares ~ x | x","flair.boot.ResHeaders ~ x | x","flair.boot.DIContainer","x | isVue::flair.boot.VueSetup ~ x","flair.boot.ServerRouter ~ x | flair.boot.ClientRouter | x"]).push(...It.boot.bootwares);for(let n of t)(n=lt(n))&&(i=I(await d(n),e))&&(r=new i,a.push(r),r.info.isMountSpecific&&s.push(r))},v=async t=>{if(et.isWorker){0!==s.length&&console.warn("Mount specific bootwares are not supported for worker environment. Revisit worker:flair.app->load setting.");for(let e of a)e.info.isMountSpecific||await e[t]()}else{let e=l.host().mounts,i=Object.keys(e),r="",n=null;n=e[r="main"];for(let e of a)await e[t](n);for(let a of i)if("main"!==a){n=e[a];for(let e of s)await e[t](n)}}},x=async()=>{const t=await d(It.host),e=await d(It.app);if(!et.isWorker){let e=new t;await e.boot(),l.host(e)}await v("boot");let a=new e;await a.boot(),l.app(a)},A=async()=>{et.isWorker||await l.host().start(),await l.app().start()},C=()=>new Promise((t,e)=>{"loading"!==document.readyState?t():(!0).document.addEventListener("DOMContentLoaded",()=>{t()})}),S=()=>new Promise((t,e)=>{(!0).document.addEventListener("deviceready",()=>{t()},!1)}),k=async()=>{et.isClient&&!et.isWorker&&(await C(),et.isCordova&&await S()),et.isWorker||await l.host().ready(),await v("ready"),await l.app().ready()};return await n(),await p(),await f(),await c(),await h(),await m(),await w(),await b(),await g(),await x(),await A(),await k(),console.log("ready!"),!0}})})(),l.context.current().currentAssemblyBeingLoaded("","function"==typeof onLoadComplete?onLoadComplete:null),l.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","package":"flairjs-fabric","desc":"Foundation for True Object Oriented JavaScript Apps","title":"Flair.js Fabric","version":"0.60.22","lupdate":"Wed, 25 Sep 2019 04:57:42 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.app.Bootware","flair.app.HandlerContext","flair.app.Payload","flair.app.Handler","flair.app.App","flair.app.HandlerResult","flair.app.Host","flair.boot.DIContainer","flair.app.IPortHandler","flair.app.ajax.FetchAttr","flair.app.ajax.FetchPort","flair.app.caching.CacheAttr","flair.app.caching.CachePort","flair.app.BootEngine"],"resources":[],"assets":[],"routes":[]}'),Object.freeze({name:"flair.app",settings:It,config:Ct})});